"use strict";

var FIREBASE_URL = "https://movieagenda.firebaseio.com";
var fb = new Firebase(FIREBASE_URL);
var movielist;
var API_URL = "http://www.omdbapi.com/?t=";
var $SUBMITBUTTON = $(".submit");
var $TEXTFIELD = $(".textfield");
var $MOVIEINFO = $(".movie-info");
var $MOVIETABLECONTAINER = $(".movie-table-container");
var movie_info_obj;
var poster_url;
var TMDB_API_KEY = "?api_key=3d3efaa01fcce58b6e8758f0f9d9c93d";
var TMDB_SEARCH_URL = "http://api.themoviedb.org/3/search/movie";
var TMDB_POSTER_BASE = "http://image.tmdb.org/t/p/w500";
var TRAILER_API_URL = "http://crossorigin.me/http://api.traileraddict.com/?film=";
var authData;

fb.onAuth(function (authData) {
  authData = authData;
  if (!authData && window.location.pathname !== "/movieagenda/login/") {
    window.location = "/movieagenda/login";
  } else if (authData) {
    // THE BELOW CODE DOES NOT WORK (if at top of code) BECAUSE:
    // if you *are* on the login page and aren't logged in, the program will *still*
    // take you to the saveAuthData function, execute the function, and throw an error when it tries to read
    // the uid of null (authData is null), *halting* execution of the rest of the script.
    // Page is still usable but the submit handler for "login" hasn't been executed/applied, so it'll just
    // do the default action and refresh the page; user still isn't logged in.
    // WILL WORK AT BOTTOM OF CODE BECAUSE:
    // By the time the error is thrown and the script halts, all the handlers have already
    // been applied (this handler would be the last thing executed, after all).
    // BUT IT MAKES MUCH MORE SENSE TO USE THE ABOVE CODE, WHICH PREVENTS THE ERROR IN QUESTION.
    // } else {
    saveAuthData(authData);
  }
  clearLoginForm();
});

if (window.location.pathname === "/movieagenda/table/") {
  $(".crumbs-left").append($("<p>Welcome, " + fb.getAuth().password.email.split("@")[0] + "!</p>"));
  movielist = fb.child("users/" + fb.getAuth().uid + "/movielist");
  // will add to user's table whenever a movie is added to FirebaseDB (occurs within)
  // submit button clickhandler.
  movielist.on("child_added", function (snapshot) {
    addToTable(snapshot.val(), snapshot.key());
  });
  // will remove from user's table whenever something is deleted from FirebaseDB
  // (occurs within delete button clickhandler) as written below:
  movielist.on("child_removed", function (snapshot) {
    $("[data_id='" + snapshot.key() + "']").fadeOut(500, function () {
      $(this).closest("tr").remove();
      if (!$("td").length) {
        $("table").remove();
      }
    });
  });
}

$(".login-page form").submit(function (event) {
  event.preventDefault();
  var email = $(".login-page input[type=\"email\"]").val();
  var password = $(".login-page input[type=\"password\"]").val();
  console.log("logging in");
  doLogin(email, password);
});

$(".doLogout").click(function () {
  fb.unauth();
});

$(".doRegister").click(function (event) {
  event.preventDefault();
  var email = $(".login-page input[type=\"email\"]").val();
  var password = $(".login-page input[type=\"password\"]").val();

  fb.createUser({
    email: email,
    password: password
  }, function (err, userData) {
    if (err) {
      alert(err.toString());
    } else {
      doLogin(email, password);
    }
  });
});

$(".reset-password form").submit(function () {
  var email = fb.getAuth().password.email;
  var oldPw = $("#oldpass").val();
  var newPw = $("#newpass").val();

  fb.changePassword({
    email: email,
    oldPassword: oldPw,
    newPassword: newPw
  }, function (err) {
    if (err) {
      alert(err.toString());
    } else {
      fb.unauth();
    }
  });
  event.preventDefault();
});

$(".doResetPassword").click(function () {
  event.preventDefault();
  var email = $(".login-page input[type=\"email\"]").val();

  fb.resetPassword({
    email: email
  }, function (err) {
    if (err) {
      alert(err.toString());
    } else {
      alert("Please check your email for further instructions.");
    }
  });
});

function doLogin(email, password, callback) {
  fb.authWithPassword({
    email: email,
    password: password
  }, function (err, authData) {
    if (err) {
      alert(err.toString());
    } else {
      typeof callback === "function" && callback(authData);
    }
  });
}

function saveAuthData(authData) {
  var ref = fb.child("users/" + authData.uid + "/profile");
  ref.set(authData, postAuthRouting(authData));
}

function postAuthRouting(authData) {
  if (authData && authData.password.isTemporaryPassword && window.location.pathname !== "/movieagenda/resetpassword/") {
    window.location = "/movieagenda/resetpassword";
  } else if (authData && !authData.password.isTemporaryPassword && window.location.pathname !== "/movieagenda/table/") {
    window.location = "/movieagenda/table";
  }
}

// 	$.ajax({
//     method: 'PUT',
//     url: `${FIREBASE_URL}/users/${authData.uid}/profile.json?auth=${fb.getAuth().token}`,
//     data: JSON.stringify(authData)
// 	}).done(function() {
// 		if (authData && authData.password.isTemporaryPassword && window.location.pathname !== "/resetpassword/") {
// 			window.location = "/resetpassword";
// 		} else if (authData && !authData.password.isTemporaryPassword && window.location.pathname !== "/table/") {
// 		  window.location = "/table";
// 		}
// 	});
// }

function clearLoginForm() {
  $(".login-page input[type=\"email\"]").val("");
  $(".login-page input[type=\"password\"]").val("");
}

function getSearchParams() {
  var movie_title = $TEXTFIELD.val();
  var search_params = movie_title.split(" ").join("+");
  return search_params;
}

$SUBMITBUTTON.click(function (event) {
  event.preventDefault();
  var tmdb_search_url = TMDB_SEARCH_URL + TMDB_API_KEY + "&query=" + getSearchParams();
  $.get(tmdb_search_url, setPosterUrl, "jsonp");
});

function setPosterUrl(obj) {
  if (obj.total_results === 0) {
    $MOVIEINFO.empty();
    $MOVIEINFO.append(makeError());
    setTimeout(function () {
      $(".error").fadeOut(500, function () {
        $(".error").remove();
      });
    }, 3000);
    return false;
  }
  var poster_path = obj.results && obj.results[0] && obj.results[0].poster_path;
  poster_url = TMDB_POSTER_BASE + poster_path + TMDB_API_KEY;
  // have the poster url; now get the rest of the data according to the title as it was return by the
  // object bearing the poster path (to keep consistency between both APIs' search results).
  var request_url = API_URL + (obj.results && obj.results[0] && obj.results[0].original_title.split(" ").join("+"));
  $.get(request_url, addMovieInfo, "jsonp");
}

$MOVIEINFO.on("click", ".add-button", function (event) {
  event.preventDefault();
  writeToFirebase(movie_info_obj);
});

$MOVIETABLECONTAINER.on("click", "button.watched-btn", function (event) {
  event.preventDefault();
  deleteFromFirebase($(this).closest("tr").attr("data_id"));
  // $(this).closest('tr').fadeOut(500, function() {
  //   $(this).closest('tr').remove();
  //   if (!($('td').length)) {
  //     $('table').remove();
  //   }
  // });
});

$(".movie-info, .movie-table-container").on("click", "button.trailer-btn", function (event) {
  event.preventDefault();
  var query = $(this).attr("query");
  $.get(TRAILER_API_URL + query + "&count=10", function (dataXML) {
    var trailer = $.parseXML(dataXML);
    var $embeds = $($(trailer).find("embed"));
    var vid_arr = $.map($embeds, function (embed) {
      return $(embed).text();
    });
    $.fancybox(vid_arr);
  });
});

$MOVIETABLECONTAINER.on("click", "img", function (event) {
  event.preventDefault();
  var id = $(this).closest("tr").attr("data_id");
  movielist.child(id).once("value", function (obj) {
    reClick(obj.val());
  });
});

// reClick is for reloading stored movies into the movie info view; don't need to rewrite the poster url.
function reClick(obj) {
  movie_info_obj = obj;
  $MOVIEINFO.empty();
  $MOVIEINFO.append(makeMovieInfo(obj));
}

function addMovieInfo(obj) {
  movie_info_obj = obj;
  movie_info_obj.Poster = poster_url;
  $MOVIEINFO.empty();
  $MOVIEINFO.append(makeMovieInfo(obj));
}

function makeError() {
  var $error = $("<div><p>(´Ａ｀。) No results!</p></div>");
  $error.addClass("error");
  return $error;
}

function makeMovieInfo(obj) {
  var $info_container = $("<div></div>");
  $info_container.addClass("info-container");
  var $title = $("<p>" + obj.Title + "</p>");
  var $info = $(makeRatingImgText(obj) + "<button class='trailer-btn btn btn-sm btn-default' query='" + obj.Title.replace(/[\.,-\/#!$%\^&\*;:{}=\-_`~()]/g, "").split(" ").join("-") + "'>View clips</button><span " + makeMetaRatingText(obj) + "</span><p class='imdb-rating'>" + obj.imdbRating + "</p></span><span>&nbsp" + obj.Year + "</span><span>&nbsp&nbsp&nbsp" + obj.Runtime + "</span>");
  $title.addClass("title");
  var $director = $("<p>Director: " + obj.Director + "</p>");
  var $plot = $("<p>" + obj.Plot + "</p>");
  var $add_button = $("<button>Add to my list</button>");
  $add_button.addClass("add-button btn btn-lg btn-success pull-right");

  var $poster = $("<img src='" + obj.Poster + "'></img>");
  $poster.addClass("pull-left");
  $info_container.append($poster);
  $info_container.append($title).append($info).append($director).append($plot).append($add_button);
  return $info_container;
}

function addToTable(obj, id) {
  if (!$("table").length) {
    $MOVIETABLECONTAINER.append(makeTableHeader());
  }
  $("table").append(makeTableRow(obj, id));
}

function makeTableHeader() {
  var $table = $("<table></table>");
  $table.addClass("table table-striped");
  var $header_row = $("<tr></tr>");
  var $header_elements = $("<th></th><th>Title</th><th>Year</th><th>Rating</th><th>Clips</th><th>Metascore</th><th>imdb</th><th></th>");
  $header_row.append($header_elements);
  $table.append($header_row);
  return $table;
}

function makeTableRow(obj, id) {
  var $row = $("<tr></tr>");
  var $poster_td;
  $row.attr("data_id", id || obj.data_id);
  obj.Poster === "N/A" ? $poster_td = $("<td><img src='" + "https://www.utopolis.lu/bundles/utopoliscommon/images/movies/movie-placeholder.jpg" + "'></td>") : $poster_td = $("<td><img src='" + obj.Poster + "'></src>");
  var other_rows = "<td>" + obj.Title + "</td><td>" + obj.Year + "</td><td>";
  other_rows += makeRatingImgText(obj);
  other_rows += "</td>";
  other_rows += "<td><button class='trailer-btn' query='" + obj.Title.replace(/[\.,-\/#!$%\^&\*;:{}=\-_`~()]/g, "").split(" ").join("-") + "'>View</button>";
  other_rows += "<td><p " + makeMetaRatingText(obj) + "</p></td>";
  other_rows += "<td><p class='imdb-rating'>" + obj.imdbRating + "</p></td>";
  other_rows += "<td><button class='watched-btn'>Watched</button></td>";
  var $other_rows = $(other_rows);
  $other_rows.find("button.watched-btn").addClass("btn btn-md btn-danger");
  $other_rows.find("button.trailer-btn").addClass("btn btn-md btn-default");
  $row.append($poster_td).append($other_rows);
  return $row;
}

function makeMetaRatingText(obj) {
  var return_str = "class='metascore ";
  if (parseInt(obj.Metascore) > 60) {
    return_str += "meta-positive";
  } else if (parseInt(obj.Metascore) > 39) {
    return_str += "meta-neutral";
  } else if (parseInt(obj.Metascore) >= 0) {
    return_str += "meta-negative";
  }
  return_str += "'>" + obj.Metascore;
  return return_str;
}

function makeRatingImgText(obj) {
  if (obj.Rated === "G") {
    return "<img class='rating-img' src='../images/G.svg'>";
  } else if (obj.Rated === "PG") {
    return "<img class='rating-img' src='../images/PG.svg'>";
  } else if (obj.Rated === "PG-13") {
    return "<img class='rating-img' src='../images/PG-13.svg'>";
  } else if (obj.Rated === "R") {
    return "<img class='rating-img' src='../images/R.svg'>";
  } else if (obj.Rated === "NC-17") {
    return "<img class='rating-img' src='../images/NC-17.svg'>";
  } else {
    return "<span>N/A</span>";
  }
}

function writeToFirebase(obj) {
  var newPush = movielist.push(obj);
  obj.data_id = newPush.key();

  //$.post(`${FIREBASE_URL}/users/${fb.getAuth().uid}/movielist.json?auth=${fb.getAuth().token}`, JSON.stringify(obj), function(response) {
  //  obj.data_id = response.name;
  //})
}

function deleteFromFirebase(id) {
  movielist.child(id).set(null);

  // var deleteUrl = `${FIREBASE_URL}/users/${fb.getAuth().uid}/movielist/${id}.json?auth=${fb.getAuth().token}`;
  // $.ajax({url: deleteUrl, type: 'DELETE'});
}

//function tableLoad() {
//  $.get(`${FIREBASE_URL}/users/${fb.getAuth().uid}/movielist.json?auth=${fb.getAuth().token}`, function(db_data) {
//    db_data && _(db_data).forEach(function(value, key) {
//      addToTable(value, key);
//    }).value();
//  })
//}
//   var token = fb.getAuth().token;
//   $.get(`${FIREBASE_URL}/users/${fb.getAuth().uid}/movielist/${id}.json?auth=${token}`, reClick, "jsonp");
//# sourceMappingURL=data:application/json;base64,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QU8sRUFBRTtBQUNqQyxXQUFPLG9EQUFvRCxDQUFDO0dBQzVELE1BQU07QUFDTixXQUFPLGtCQUFrQixDQUFBO0dBQ3pCO0NBQ0Y7O0FBRUQsU0FBUyxlQUFlLENBQUMsR0FBRyxFQUFFO0FBQzVCLE1BQUksT0FBTyxHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDbEMsS0FBRyxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUMsR0FBRyxFQUFFLENBQUM7Ozs7O0NBSzdCOztBQUVELFNBQVMsa0JBQWtCLENBQUMsRUFBRSxFQUFFO0FBQzlCLFdBQVMsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDOzs7O0NBSS9COzs7Ozs7Ozs7QUFBQSIsImZpbGUiOiJzcmMvanMvbWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBGSVJFQkFTRV9VUkwgPSBcImh0dHBzOi8vbW92aWVhZ2VuZGEuZmlyZWJhc2Vpby5jb21cIjtcbnZhciBmYiA9IG5ldyBGaXJlYmFzZShGSVJFQkFTRV9VUkwpO1xudmFyIG1vdmllbGlzdDtcbnZhciBBUElfVVJMID0gXCJodHRwOi8vd3d3Lm9tZGJhcGkuY29tLz90PVwiO1xudmFyICRTVUJNSVRCVVRUT04gPSAkKFwiLnN1Ym1pdFwiKTtcbnZhciAkVEVYVEZJRUxEID0gJChcIi50ZXh0ZmllbGRcIik7XG52YXIgJE1PVklFSU5GTyA9ICQoXCIubW92aWUtaW5mb1wiKTtcbnZhciAkTU9WSUVUQUJMRUNPTlRBSU5FUiA9ICQoXCIubW92aWUtdGFibGUtY29udGFpbmVyXCIpO1xudmFyIG1vdmllX2luZm9fb2JqO1xudmFyIHBvc3Rlcl91cmw7XG52YXIgVE1EQl9BUElfS0VZID0gXCI/YXBpX2tleT0zZDNlZmFhMDFmY2NlNThiNmU4NzU4ZjBmOWQ5YzkzZFwiO1xudmFyIFRNREJfU0VBUkNIX1VSTCA9IFwiaHR0cDovL2FwaS50aGVtb3ZpZWRiLm9yZy8zL3NlYXJjaC9tb3ZpZVwiO1xudmFyIFRNREJfUE9TVEVSX0JBU0UgPSBcImh0dHA6Ly9pbWFnZS50bWRiLm9yZy90L3AvdzUwMFwiO1xudmFyIFRSQUlMRVJfQVBJX1VSTCA9IFwiaHR0cDovL2Nyb3Nzb3JpZ2luLm1lL2h0dHA6Ly9hcGkudHJhaWxlcmFkZGljdC5jb20vP2ZpbG09XCI7XG52YXIgYXV0aERhdGE7XG5cbmZiLm9uQXV0aChmdW5jdGlvbihhdXRoRGF0YSkge1xuICBhdXRoRGF0YSA9IGF1dGhEYXRhO1xuICBpZiAoIWF1dGhEYXRhICYmIHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSAhPT0gXCIvbW92aWVhZ2VuZGEvbG9naW4vXCIpe1xuXHQgIHdpbmRvdy5sb2NhdGlvbiA9IFwiL21vdmllYWdlbmRhL2xvZ2luXCI7XG4gIH0gZWxzZSBpZiAoYXV0aERhdGEpIHtcbi8vIFRIRSBCRUxPVyBDT0RFIERPRVMgTk9UIFdPUksgKGlmIGF0IHRvcCBvZiBjb2RlKSBCRUNBVVNFOlxuLy8gaWYgeW91ICphcmUqIG9uIHRoZSBsb2dpbiBwYWdlIGFuZCBhcmVuJ3QgbG9nZ2VkIGluLCB0aGUgcHJvZ3JhbSB3aWxsICpzdGlsbCpcbi8vIHRha2UgeW91IHRvIHRoZSBzYXZlQXV0aERhdGEgZnVuY3Rpb24sIGV4ZWN1dGUgdGhlIGZ1bmN0aW9uLCBhbmQgdGhyb3cgYW4gZXJyb3Igd2hlbiBpdCB0cmllcyB0byByZWFkXG4vLyB0aGUgdWlkIG9mIG51bGwgKGF1dGhEYXRhIGlzIG51bGwpLCAqaGFsdGluZyogZXhlY3V0aW9uIG9mIHRoZSByZXN0IG9mIHRoZSBzY3JpcHQuXG4vLyBQYWdlIGlzIHN0aWxsIHVzYWJsZSBidXQgdGhlIHN1Ym1pdCBoYW5kbGVyIGZvciBcImxvZ2luXCIgaGFzbid0IGJlZW4gZXhlY3V0ZWQvYXBwbGllZCwgc28gaXQnbGwganVzdFxuLy8gZG8gdGhlIGRlZmF1bHQgYWN0aW9uIGFuZCByZWZyZXNoIHRoZSBwYWdlOyB1c2VyIHN0aWxsIGlzbid0IGxvZ2dlZCBpbi5cbi8vIFdJTEwgV09SSyBBVCBCT1RUT00gT0YgQ09ERSBCRUNBVVNFOlxuLy8gQnkgdGhlIHRpbWUgdGhlIGVycm9yIGlzIHRocm93biBhbmQgdGhlIHNjcmlwdCBoYWx0cywgYWxsIHRoZSBoYW5kbGVycyBoYXZlIGFscmVhZHlcbi8vIGJlZW4gYXBwbGllZCAodGhpcyBoYW5kbGVyIHdvdWxkIGJlIHRoZSBsYXN0IHRoaW5nIGV4ZWN1dGVkLCBhZnRlciBhbGwpLlxuLy8gQlVUIElUIE1BS0VTIE1VQ0ggTU9SRSBTRU5TRSBUTyBVU0UgVEhFIEFCT1ZFIENPREUsIFdISUNIIFBSRVZFTlRTIFRIRSBFUlJPUiBJTiBRVUVTVElPTi5cbi8vIH0gZWxzZSB7XG5cdFx0c2F2ZUF1dGhEYXRhKGF1dGhEYXRhKTtcblx0fVxuXHRjbGVhckxvZ2luRm9ybSgpO1xufSk7XG5cbmlmICh3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgPT09IFwiL21vdmllYWdlbmRhL3RhYmxlL1wiKSB7XG5cdCQoJy5jcnVtYnMtbGVmdCcpLmFwcGVuZCgkKGA8cD5XZWxjb21lLCAke2ZiLmdldEF1dGgoKS5wYXNzd29yZC5lbWFpbC5zcGxpdChcIkBcIilbMF19ITwvcD5gKSlcbiAgbW92aWVsaXN0ID0gZmIuY2hpbGQoYHVzZXJzLyR7ZmIuZ2V0QXV0aCgpLnVpZH0vbW92aWVsaXN0YCk7XG4gIC8vIHdpbGwgYWRkIHRvIHVzZXIncyB0YWJsZSB3aGVuZXZlciBhIG1vdmllIGlzIGFkZGVkIHRvIEZpcmViYXNlREIgKG9jY3VycyB3aXRoaW4pXG4gIC8vIHN1Ym1pdCBidXR0b24gY2xpY2toYW5kbGVyLlxuICBtb3ZpZWxpc3Qub24oJ2NoaWxkX2FkZGVkJywgZnVuY3Rpb24oc25hcHNob3QpIHtcbiAgICBhZGRUb1RhYmxlKHNuYXBzaG90LnZhbCgpLCBzbmFwc2hvdC5rZXkoKSk7XG4gIH0pO1xuICAvLyB3aWxsIHJlbW92ZSBmcm9tIHVzZXIncyB0YWJsZSB3aGVuZXZlciBzb21ldGhpbmcgaXMgZGVsZXRlZCBmcm9tIEZpcmViYXNlREJcbiAgLy8gKG9jY3VycyB3aXRoaW4gZGVsZXRlIGJ1dHRvbiBjbGlja2hhbmRsZXIpIGFzIHdyaXR0ZW4gYmVsb3c6XG4gIG1vdmllbGlzdC5vbignY2hpbGRfcmVtb3ZlZCcsIGZ1bmN0aW9uKHNuYXBzaG90KSB7XG4gICAgJChcIltkYXRhX2lkPSdcIiArIHNuYXBzaG90LmtleSgpICsgXCInXVwiKS5mYWRlT3V0KDUwMCwgZnVuY3Rpb24oKSB7XG4gICAgICAkKHRoaXMpLmNsb3Nlc3QoJ3RyJykucmVtb3ZlKCk7XG4gICAgICAgIGlmICghKCQoJ3RkJykubGVuZ3RoKSkge1xuICAgICAgICAgICQoJ3RhYmxlJykucmVtb3ZlKCk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG59XG5cbiQoJy5sb2dpbi1wYWdlIGZvcm0nKS5zdWJtaXQoZnVuY3Rpb24oZXZlbnQpIHtcblx0ZXZlbnQucHJldmVudERlZmF1bHQoKTtcblx0dmFyIGVtYWlsID0gJCgnLmxvZ2luLXBhZ2UgaW5wdXRbdHlwZT1cImVtYWlsXCJdJykudmFsKCk7XG5cdHZhciBwYXNzd29yZCA9ICQoJy5sb2dpbi1wYWdlIGlucHV0W3R5cGU9XCJwYXNzd29yZFwiXScpLnZhbCgpO1xuICBjb25zb2xlLmxvZyhcImxvZ2dpbmcgaW5cIik7XG5cdGRvTG9naW4oZW1haWwsIHBhc3N3b3JkKTtcbn0pO1xuXG4kKCcuZG9Mb2dvdXQnKS5jbGljayhmdW5jdGlvbigpIHtcblx0ZmIudW5hdXRoKCk7XG59KVxuXG4kKCcuZG9SZWdpc3RlcicpLmNsaWNrKGZ1bmN0aW9uKGV2ZW50KSB7XG5cdGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cdHZhciBlbWFpbCA9ICQoJy5sb2dpbi1wYWdlIGlucHV0W3R5cGU9XCJlbWFpbFwiXScpLnZhbCgpO1xuXHR2YXIgcGFzc3dvcmQgPSAkKCcubG9naW4tcGFnZSBpbnB1dFt0eXBlPVwicGFzc3dvcmRcIl0nKS52YWwoKTtcblxuXHRmYi5jcmVhdGVVc2VyKHtcblx0XHRlbWFpbDogZW1haWwsXG5cdFx0cGFzc3dvcmQ6IHBhc3N3b3JkXG5cdH0sIGZ1bmN0aW9uKGVyciwgdXNlckRhdGEpIHtcblx0XHRpZiAoZXJyKSB7XG5cdFx0XHRhbGVydChlcnIudG9TdHJpbmcoKSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGRvTG9naW4oZW1haWwsIHBhc3N3b3JkKTtcblx0XHR9XG5cdH0pO1xufSlcblxuJCgnLnJlc2V0LXBhc3N3b3JkIGZvcm0nKS5zdWJtaXQoZnVuY3Rpb24oKSB7XG5cdHZhciBlbWFpbCA9IGZiLmdldEF1dGgoKS5wYXNzd29yZC5lbWFpbDtcblx0dmFyIG9sZFB3ID0gJCgnI29sZHBhc3MnKS52YWwoKTtcblx0dmFyIG5ld1B3ID0gJCgnI25ld3Bhc3MnKS52YWwoKTtcblxuXHRmYi5jaGFuZ2VQYXNzd29yZCh7XG5cdFx0ZW1haWw6IGVtYWlsLFxuXHRcdG9sZFBhc3N3b3JkOiBvbGRQdyxcblx0XHRuZXdQYXNzd29yZDogbmV3UHdcblx0fSwgZnVuY3Rpb24oZXJyKSB7XG5cdFx0aWYgKGVycikge1xuXHRcdFx0YWxlcnQoZXJyLnRvU3RyaW5nKCkpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRmYi51bmF1dGgoKTtcblx0XHR9XG5cdH0pO1xuXHRldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xufSk7XG5cbiQoJy5kb1Jlc2V0UGFzc3dvcmQnKS5jbGljayhmdW5jdGlvbigpIHtcblx0ZXZlbnQucHJldmVudERlZmF1bHQoKTtcblx0dmFyIGVtYWlsID0gJCgnLmxvZ2luLXBhZ2UgaW5wdXRbdHlwZT1cImVtYWlsXCJdJykudmFsKCk7XG5cblx0ZmIucmVzZXRQYXNzd29yZCh7XG5cdFx0ZW1haWw6IGVtYWlsXG5cdH0sIGZ1bmN0aW9uKGVycikge1xuXHRcdGlmIChlcnIpIHtcblx0XHRcdGFsZXJ0KGVyci50b1N0cmluZygpKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0YWxlcnQoXCJQbGVhc2UgY2hlY2sgeW91ciBlbWFpbCBmb3IgZnVydGhlciBpbnN0cnVjdGlvbnMuXCIpO1xuXHRcdH1cblx0fSk7XG59KTtcblxuZnVuY3Rpb24gZG9Mb2dpbihlbWFpbCwgcGFzc3dvcmQsIGNhbGxiYWNrKSB7XG5cdGZiLmF1dGhXaXRoUGFzc3dvcmQoe1xuXHRcdGVtYWlsOiBlbWFpbCxcblx0XHRwYXNzd29yZDogcGFzc3dvcmRcblx0fSwgZnVuY3Rpb24oZXJyLCBhdXRoRGF0YSl7XG5cdFx0aWYgKGVycikge1xuXHRcdFx0YWxlcnQoZXJyLnRvU3RyaW5nKCkpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicgJiYgY2FsbGJhY2soYXV0aERhdGEpO1xuXHRcdH1cblx0fSk7XG59XG5cbmZ1bmN0aW9uIHNhdmVBdXRoRGF0YSAoYXV0aERhdGEpIHtcblx0dmFyIHJlZiA9IGZiLmNoaWxkKGB1c2Vycy8ke2F1dGhEYXRhLnVpZH0vcHJvZmlsZWApO1xuXHRyZWYuc2V0KGF1dGhEYXRhLCBwb3N0QXV0aFJvdXRpbmcoYXV0aERhdGEpKTtcbn1cblxuZnVuY3Rpb24gcG9zdEF1dGhSb3V0aW5nKGF1dGhEYXRhKSB7XG5cdGlmIChhdXRoRGF0YSAmJiBhdXRoRGF0YS5wYXNzd29yZC5pc1RlbXBvcmFyeVBhc3N3b3JkICYmIHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSAhPT0gXCIvbW92aWVhZ2VuZGEvcmVzZXRwYXNzd29yZC9cIikge1xuXHRcdFx0d2luZG93LmxvY2F0aW9uID0gXCIvbW92aWVhZ2VuZGEvcmVzZXRwYXNzd29yZFwiO1xuXHRcdH0gZWxzZSBpZiAoYXV0aERhdGEgJiYgIWF1dGhEYXRhLnBhc3N3b3JkLmlzVGVtcG9yYXJ5UGFzc3dvcmQgJiYgd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lICE9PSBcIi9tb3ZpZWFnZW5kYS90YWJsZS9cIikge1xuXHRcdCAgd2luZG93LmxvY2F0aW9uID0gXCIvbW92aWVhZ2VuZGEvdGFibGVcIjtcblx0XHR9XG59XG5cbi8vIFx0JC5hamF4KHtcbi8vICAgICBtZXRob2Q6ICdQVVQnLFxuLy8gICAgIHVybDogYCR7RklSRUJBU0VfVVJMfS91c2Vycy8ke2F1dGhEYXRhLnVpZH0vcHJvZmlsZS5qc29uP2F1dGg9JHtmYi5nZXRBdXRoKCkudG9rZW59YCxcbi8vICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeShhdXRoRGF0YSlcbi8vIFx0fSkuZG9uZShmdW5jdGlvbigpIHtcbi8vIFx0XHRpZiAoYXV0aERhdGEgJiYgYXV0aERhdGEucGFzc3dvcmQuaXNUZW1wb3JhcnlQYXNzd29yZCAmJiB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgIT09IFwiL3Jlc2V0cGFzc3dvcmQvXCIpIHtcbi8vIFx0XHRcdHdpbmRvdy5sb2NhdGlvbiA9IFwiL3Jlc2V0cGFzc3dvcmRcIjtcbi8vIFx0XHR9IGVsc2UgaWYgKGF1dGhEYXRhICYmICFhdXRoRGF0YS5wYXNzd29yZC5pc1RlbXBvcmFyeVBhc3N3b3JkICYmIHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSAhPT0gXCIvdGFibGUvXCIpIHtcbi8vIFx0XHQgIHdpbmRvdy5sb2NhdGlvbiA9IFwiL3RhYmxlXCI7XG4vLyBcdFx0fVxuLy8gXHR9KTtcbi8vIH1cblxuZnVuY3Rpb24gY2xlYXJMb2dpbkZvcm0oKSB7XG5cdCQoJy5sb2dpbi1wYWdlIGlucHV0W3R5cGU9XCJlbWFpbFwiXScpLnZhbCgnJyk7XG5cdCQoJy5sb2dpbi1wYWdlIGlucHV0W3R5cGU9XCJwYXNzd29yZFwiXScpLnZhbCgnJyk7XG59XG5cbmZ1bmN0aW9uIGdldFNlYXJjaFBhcmFtcygpIHtcbiAgdmFyIG1vdmllX3RpdGxlID0gJFRFWFRGSUVMRC52YWwoKTtcbiAgdmFyIHNlYXJjaF9wYXJhbXMgPSBtb3ZpZV90aXRsZS5zcGxpdChcIiBcIikuam9pbihcIitcIik7XG4gIHJldHVybiBzZWFyY2hfcGFyYW1zO1xufVxuXG4kU1VCTUlUQlVUVE9OLmNsaWNrKGZ1bmN0aW9uKGV2ZW50KSB7XG4gIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gIHZhciB0bWRiX3NlYXJjaF91cmwgPSBUTURCX1NFQVJDSF9VUkwgKyBUTURCX0FQSV9LRVkgKyBcIiZxdWVyeT1cIiArIGdldFNlYXJjaFBhcmFtcygpO1xuICAkLmdldCh0bWRiX3NlYXJjaF91cmwsIHNldFBvc3RlclVybCwgJ2pzb25wJyk7XG59KVxuXG5mdW5jdGlvbiBzZXRQb3N0ZXJVcmwob2JqKSB7XG4gIGlmIChvYmoudG90YWxfcmVzdWx0cyA9PT0gMCkge1xuICAgICRNT1ZJRUlORk8uZW1wdHkoKTtcbiAgICAkTU9WSUVJTkZPLmFwcGVuZChtYWtlRXJyb3IoKSk7XG4gICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICQoXCIuZXJyb3JcIikuZmFkZU91dCg1MDAsIGZ1bmN0aW9uKCkge1xuICAgICAgICAkKFwiLmVycm9yXCIpLnJlbW92ZSgpO1xuICAgICAgfSlcbiAgICB9LCAzMDAwKVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICB2YXIgcG9zdGVyX3BhdGggPSBvYmoucmVzdWx0cyAmJiBvYmoucmVzdWx0c1swXSAmJiBvYmoucmVzdWx0c1swXS5wb3N0ZXJfcGF0aDtcbiAgcG9zdGVyX3VybCA9IFRNREJfUE9TVEVSX0JBU0UgKyBwb3N0ZXJfcGF0aCArIFRNREJfQVBJX0tFWTtcbiAgLy8gaGF2ZSB0aGUgcG9zdGVyIHVybDsgbm93IGdldCB0aGUgcmVzdCBvZiB0aGUgZGF0YSBhY2NvcmRpbmcgdG8gdGhlIHRpdGxlIGFzIGl0IHdhcyByZXR1cm4gYnkgdGhlXG4gIC8vIG9iamVjdCBiZWFyaW5nIHRoZSBwb3N0ZXIgcGF0aCAodG8ga2VlcCBjb25zaXN0ZW5jeSBiZXR3ZWVuIGJvdGggQVBJcycgc2VhcmNoIHJlc3VsdHMpLlxuICB2YXIgcmVxdWVzdF91cmwgPSBBUElfVVJMICsgKG9iai5yZXN1bHRzICYmIG9iai5yZXN1bHRzWzBdICYmIG9iai5yZXN1bHRzWzBdLm9yaWdpbmFsX3RpdGxlLnNwbGl0KFwiIFwiKS5qb2luKFwiK1wiKSk7XG4gICQuZ2V0KHJlcXVlc3RfdXJsLCBhZGRNb3ZpZUluZm8sICdqc29ucCcpO1xufVxuXG4kTU9WSUVJTkZPLm9uKCdjbGljaycsICcuYWRkLWJ1dHRvbicsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gIHdyaXRlVG9GaXJlYmFzZShtb3ZpZV9pbmZvX29iaik7XG59KVxuXG4kTU9WSUVUQUJMRUNPTlRBSU5FUi5vbignY2xpY2snLCAnYnV0dG9uLndhdGNoZWQtYnRuJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgZGVsZXRlRnJvbUZpcmViYXNlKCQodGhpcykuY2xvc2VzdCgndHInKS5hdHRyKCdkYXRhX2lkJykpO1xuICAvLyAkKHRoaXMpLmNsb3Nlc3QoJ3RyJykuZmFkZU91dCg1MDAsIGZ1bmN0aW9uKCkge1xuICAvLyAgICQodGhpcykuY2xvc2VzdCgndHInKS5yZW1vdmUoKTtcbiAgLy8gICBpZiAoISgkKCd0ZCcpLmxlbmd0aCkpIHtcbiAgLy8gICAgICQoJ3RhYmxlJykucmVtb3ZlKCk7XG4gIC8vICAgfVxuICAvLyB9KTtcbn0pXG5cbiQoJy5tb3ZpZS1pbmZvLCAubW92aWUtdGFibGUtY29udGFpbmVyJykub24oJ2NsaWNrJywgJ2J1dHRvbi50cmFpbGVyLWJ0bicsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gIHZhciBxdWVyeSA9ICQodGhpcykuYXR0cigncXVlcnknKTtcbiAgJC5nZXQoVFJBSUxFUl9BUElfVVJMICsgcXVlcnkgKyBcIiZjb3VudD0xMFwiLCBmdW5jdGlvbiAoZGF0YVhNTCkge1xuICAgIHZhciB0cmFpbGVyID0gJC5wYXJzZVhNTChkYXRhWE1MKTtcbiAgICB2YXIgJGVtYmVkcyA9ICQoJCh0cmFpbGVyKS5maW5kKCdlbWJlZCcpKTtcbiAgICB2YXIgdmlkX2FyciA9ICQubWFwKCRlbWJlZHMsIGZ1bmN0aW9uKGVtYmVkKSB7XG4gICAgXHRyZXR1cm4gJChlbWJlZCkudGV4dCgpO1xuICAgIH0pXG4gICAgJC5mYW5jeWJveCh2aWRfYXJyKTtcbiAgfSlcbn0pXG5cbiRNT1ZJRVRBQkxFQ09OVEFJTkVSLm9uKCdjbGljaycsICdpbWcnLCBmdW5jdGlvbihldmVudCkge1xuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICB2YXIgaWQgPSAkKHRoaXMpLmNsb3Nlc3QoJ3RyJykuYXR0cignZGF0YV9pZCcpO1xuICBtb3ZpZWxpc3QuY2hpbGQoaWQpLm9uY2UoXCJ2YWx1ZVwiLCBmdW5jdGlvbihvYmopIHtcbiAgXHRyZUNsaWNrKG9iai52YWwoKSk7XG4gIH0pXG4vLyAgIHZhciB0b2tlbiA9IGZiLmdldEF1dGgoKS50b2tlbjtcbi8vICAgJC5nZXQoYCR7RklSRUJBU0VfVVJMfS91c2Vycy8ke2ZiLmdldEF1dGgoKS51aWR9L21vdmllbGlzdC8ke2lkfS5qc29uP2F1dGg9JHt0b2tlbn1gLCByZUNsaWNrLCBcImpzb25wXCIpO1xufSlcblxuLy8gcmVDbGljayBpcyBmb3IgcmVsb2FkaW5nIHN0b3JlZCBtb3ZpZXMgaW50byB0aGUgbW92aWUgaW5mbyB2aWV3OyBkb24ndCBuZWVkIHRvIHJld3JpdGUgdGhlIHBvc3RlciB1cmwuXG5mdW5jdGlvbiByZUNsaWNrKG9iaikge1xuICBtb3ZpZV9pbmZvX29iaiA9IG9iajtcbiAgJE1PVklFSU5GTy5lbXB0eSgpO1xuICAkTU9WSUVJTkZPLmFwcGVuZChtYWtlTW92aWVJbmZvKG9iaikpO1xufVxuXG5mdW5jdGlvbiBhZGRNb3ZpZUluZm8ob2JqKSB7XG4gIG1vdmllX2luZm9fb2JqID0gb2JqO1xuICBtb3ZpZV9pbmZvX29iai5Qb3N0ZXIgPSBwb3N0ZXJfdXJsO1xuICAkTU9WSUVJTkZPLmVtcHR5KCk7XG4gICRNT1ZJRUlORk8uYXBwZW5kKG1ha2VNb3ZpZUluZm8ob2JqKSk7XG59XG5cbmZ1bmN0aW9uIG1ha2VFcnJvcigpIHtcbiAgdmFyICRlcnJvciA9ICQoJzxkaXY+PHA+KMK077yh772A44CCKSBObyByZXN1bHRzITwvcD48L2Rpdj4nKVxuICAkZXJyb3IuYWRkQ2xhc3MoXCJlcnJvclwiKTtcbiAgcmV0dXJuICRlcnJvcjtcbn1cblxuZnVuY3Rpb24gbWFrZU1vdmllSW5mbyhvYmopIHtcbiAgdmFyICRpbmZvX2NvbnRhaW5lciA9ICQoJzxkaXY+PC9kaXY+Jyk7XG4gICRpbmZvX2NvbnRhaW5lci5hZGRDbGFzcyhcImluZm8tY29udGFpbmVyXCIpO1xuICB2YXIgJHRpdGxlID0gJChcIjxwPlwiICsgb2JqLlRpdGxlICsgXCI8L3A+XCIpO1xuICB2YXIgJGluZm8gPSAkKG1ha2VSYXRpbmdJbWdUZXh0KG9iaikgKyBcIjxidXR0b24gY2xhc3M9J3RyYWlsZXItYnRuIGJ0biBidG4tc20gYnRuLWRlZmF1bHQnIHF1ZXJ5PSdcIiArIG9iai5UaXRsZS5yZXBsYWNlKC9bXFwuLC1cXC8jISQlXFxeJlxcKjs6e309XFwtX2B+KCldL2csXCJcIikuc3BsaXQoXCIgXCIpLmpvaW4oXCItXCIpICsgXCInPlZpZXcgY2xpcHM8L2J1dHRvbj48c3BhbiBcIiArIG1ha2VNZXRhUmF0aW5nVGV4dChvYmopICsgXCI8L3NwYW4+PHAgY2xhc3M9J2ltZGItcmF0aW5nJz5cIiArIG9iai5pbWRiUmF0aW5nICsgXCI8L3A+PC9zcGFuPjxzcGFuPiZuYnNwXCIgKyBvYmouWWVhciArIFwiPC9zcGFuPjxzcGFuPiZuYnNwJm5ic3AmbmJzcFwiICsgb2JqLlJ1bnRpbWUgKyBcIjwvc3Bhbj5cIik7XG4gICR0aXRsZS5hZGRDbGFzcyhcInRpdGxlXCIpO1xuICB2YXIgJGRpcmVjdG9yID0gJChcIjxwPkRpcmVjdG9yOiBcIiArIG9iai5EaXJlY3RvciArIFwiPC9wPlwiKTtcbiAgdmFyICRwbG90ID0gJChcIjxwPlwiICsgb2JqLlBsb3QgKyBcIjwvcD5cIik7XG4gIHZhciAkYWRkX2J1dHRvbiA9ICQoXCI8YnV0dG9uPkFkZCB0byBteSBsaXN0PC9idXR0b24+XCIpO1xuICAkYWRkX2J1dHRvbi5hZGRDbGFzcyhcImFkZC1idXR0b24gYnRuIGJ0bi1sZyBidG4tc3VjY2VzcyBwdWxsLXJpZ2h0XCIpO1xuXG4gIHZhciAkcG9zdGVyID0gJChcIjxpbWcgc3JjPSdcIiArIG9iai5Qb3N0ZXIgKyBcIic+PC9pbWc+XCIpO1xuICAkcG9zdGVyLmFkZENsYXNzKFwicHVsbC1sZWZ0XCIpO1xuICAkaW5mb19jb250YWluZXIuYXBwZW5kKCRwb3N0ZXIpO1xuICAkaW5mb19jb250YWluZXIuYXBwZW5kKCR0aXRsZSkuYXBwZW5kKCRpbmZvKS5hcHBlbmQoJGRpcmVjdG9yKS5hcHBlbmQoJHBsb3QpLmFwcGVuZCgkYWRkX2J1dHRvbik7XG4gIHJldHVybiAkaW5mb19jb250YWluZXI7XG59XG5cbmZ1bmN0aW9uIGFkZFRvVGFibGUob2JqLCBpZCkge1xuICBpZiAoISgkKFwidGFibGVcIikubGVuZ3RoKSkge1xuICAgICRNT1ZJRVRBQkxFQ09OVEFJTkVSLmFwcGVuZChtYWtlVGFibGVIZWFkZXIoKSk7XG4gIH1cbiAgJChcInRhYmxlXCIpLmFwcGVuZChtYWtlVGFibGVSb3cob2JqLCBpZCkpO1xufVxuXG5mdW5jdGlvbiBtYWtlVGFibGVIZWFkZXIoKSB7XG4gIHZhciAkdGFibGU9ICQoXCI8dGFibGU+PC90YWJsZT5cIik7XG4gICR0YWJsZS5hZGRDbGFzcyhcInRhYmxlIHRhYmxlLXN0cmlwZWRcIik7XG4gIHZhciAkaGVhZGVyX3JvdyA9ICQoXCI8dHI+PC90cj5cIik7XG4gIHZhciAkaGVhZGVyX2VsZW1lbnRzID0gJChcIjx0aD48L3RoPjx0aD5UaXRsZTwvdGg+PHRoPlllYXI8L3RoPjx0aD5SYXRpbmc8L3RoPjx0aD5DbGlwczwvdGg+PHRoPk1ldGFzY29yZTwvdGg+PHRoPmltZGI8L3RoPjx0aD48L3RoPlwiKTtcbiAgJGhlYWRlcl9yb3cuYXBwZW5kKCRoZWFkZXJfZWxlbWVudHMpO1xuICAkdGFibGUuYXBwZW5kKCRoZWFkZXJfcm93KTtcbiAgcmV0dXJuICR0YWJsZTtcbn1cblxuZnVuY3Rpb24gbWFrZVRhYmxlUm93KG9iaiwgaWQpIHtcbiAgdmFyICRyb3cgPSAkKFwiPHRyPjwvdHI+XCIpO1xuICB2YXIgJHBvc3Rlcl90ZDtcbiAgJHJvdy5hdHRyKFwiZGF0YV9pZFwiLCBpZCB8fCBvYmouZGF0YV9pZCk7XG4gIG9iai5Qb3N0ZXIgPT09IFwiTi9BXCIgPyAkcG9zdGVyX3RkID0gJChcIjx0ZD48aW1nIHNyYz0nXCIgKyBcImh0dHBzOi8vd3d3LnV0b3BvbGlzLmx1L2J1bmRsZXMvdXRvcG9saXNjb21tb24vaW1hZ2VzL21vdmllcy9tb3ZpZS1wbGFjZWhvbGRlci5qcGdcIiArIFwiJz48L3RkPlwiKSA6ICRwb3N0ZXJfdGQgPSAkKFwiPHRkPjxpbWcgc3JjPSdcIiArIG9iai5Qb3N0ZXIgKyBcIic+PC9zcmM+XCIpO1xuICB2YXIgb3RoZXJfcm93cyA9IFwiPHRkPlwiICsgb2JqLlRpdGxlICsgXCI8L3RkPjx0ZD5cIiArIG9iai5ZZWFyICsgXCI8L3RkPjx0ZD5cIjtcbiAgb3RoZXJfcm93cyArPSBtYWtlUmF0aW5nSW1nVGV4dChvYmopO1xuICBvdGhlcl9yb3dzICs9IFwiPC90ZD5cIlxuICBvdGhlcl9yb3dzICs9IFwiPHRkPjxidXR0b24gY2xhc3M9J3RyYWlsZXItYnRuJyBxdWVyeT0nXCIgKyBvYmouVGl0bGUucmVwbGFjZSgvW1xcLiwtXFwvIyEkJVxcXiZcXCo7Ont9PVxcLV9gfigpXS9nLFwiXCIpLnNwbGl0KFwiIFwiKS5qb2luKFwiLVwiKSArIFwiJz5WaWV3PC9idXR0b24+XCJcbiAgb3RoZXJfcm93cyArPSBcIjx0ZD48cCBcIiArIG1ha2VNZXRhUmF0aW5nVGV4dChvYmopICsgXCI8L3A+PC90ZD5cIjtcbiAgb3RoZXJfcm93cyArPSBcIjx0ZD48cCBjbGFzcz0naW1kYi1yYXRpbmcnPlwiICsgb2JqLmltZGJSYXRpbmcgKyBcIjwvcD48L3RkPlwiO1xuICBvdGhlcl9yb3dzICs9IFwiPHRkPjxidXR0b24gY2xhc3M9J3dhdGNoZWQtYnRuJz5XYXRjaGVkPC9idXR0b24+PC90ZD5cIjtcbiAgdmFyICRvdGhlcl9yb3dzID0gJChvdGhlcl9yb3dzKTtcbiAgJG90aGVyX3Jvd3MuZmluZChcImJ1dHRvbi53YXRjaGVkLWJ0blwiKS5hZGRDbGFzcyhcImJ0biBidG4tbWQgYnRuLWRhbmdlclwiKTtcbiAgJG90aGVyX3Jvd3MuZmluZChcImJ1dHRvbi50cmFpbGVyLWJ0blwiKS5hZGRDbGFzcyhcImJ0biBidG4tbWQgYnRuLWRlZmF1bHRcIik7XG4gICRyb3cuYXBwZW5kKCRwb3N0ZXJfdGQpLmFwcGVuZCgkb3RoZXJfcm93cyk7XG4gIHJldHVybiAkcm93O1xufVxuXG5mdW5jdGlvbiBtYWtlTWV0YVJhdGluZ1RleHQob2JqKSB7XG5cdHZhciByZXR1cm5fc3RyID0gXCJjbGFzcz0nbWV0YXNjb3JlIFwiO1xuXHRpZiAocGFyc2VJbnQob2JqLk1ldGFzY29yZSkgPiA2MCkge1xuICBcdHJldHVybl9zdHIgKz0gXCJtZXRhLXBvc2l0aXZlXCI7XG4gIH0gZWxzZSBpZiAocGFyc2VJbnQob2JqLk1ldGFzY29yZSkgPiAzOSkge1xuICBcdHJldHVybl9zdHIgKz0gXCJtZXRhLW5ldXRyYWxcIjtcbiAgfSBlbHNlIGlmIChwYXJzZUludChvYmouTWV0YXNjb3JlKSA+PSAwKSB7XG4gIFx0cmV0dXJuX3N0ciArPSBcIm1ldGEtbmVnYXRpdmVcIjtcbiAgfVxuICByZXR1cm5fc3RyICs9IFwiJz5cIisgb2JqLk1ldGFzY29yZVxuICByZXR1cm4gcmV0dXJuX3N0cjtcbn1cblxuZnVuY3Rpb24gbWFrZVJhdGluZ0ltZ1RleHQob2JqKSB7XG5cdGlmIChvYmouUmF0ZWQgPT09IFwiR1wiKSB7XG4gIFx0cmV0dXJuIFwiPGltZyBjbGFzcz0ncmF0aW5nLWltZycgc3JjPScuLi9pbWFnZXMvRy5zdmcnPlwiO1xuICB9IGVsc2UgaWYgKG9iai5SYXRlZCA9PT0gXCJQR1wiKSB7XG4gIFx0cmV0dXJuIFwiPGltZyBjbGFzcz0ncmF0aW5nLWltZycgc3JjPScuLi9pbWFnZXMvUEcuc3ZnJz5cIjtcbiAgfSBlbHNlIGlmIChvYmouUmF0ZWQgPT09IFwiUEctMTNcIikge1xuICBcdHJldHVybiBcIjxpbWcgY2xhc3M9J3JhdGluZy1pbWcnIHNyYz0nLi4vaW1hZ2VzL1BHLTEzLnN2Zyc+XCI7XG4gIH0gZWxzZSBpZiAob2JqLlJhdGVkID09PSBcIlJcIikge1xuICBcdHJldHVybiBcIjxpbWcgY2xhc3M9J3JhdGluZy1pbWcnIHNyYz0nLi4vaW1hZ2VzL1Iuc3ZnJz5cIjtcbiAgfSBlbHNlIGlmIChvYmouUmF0ZWQgPT09IFwiTkMtMTdcIikge1xuICBcdHJldHVybiBcIjxpbWcgY2xhc3M9J3JhdGluZy1pbWcnIHNyYz0nLi4vaW1hZ2VzL05DLTE3LnN2Zyc+XCI7XG4gIH0gZWxzZSB7XG4gIFx0cmV0dXJuIFwiPHNwYW4+Ti9BPC9zcGFuPlwiXG4gIH1cbn1cblxuZnVuY3Rpb24gd3JpdGVUb0ZpcmViYXNlKG9iaikge1xuICB2YXIgbmV3UHVzaCA9IG1vdmllbGlzdC5wdXNoKG9iaik7XG4gIG9iai5kYXRhX2lkID0gbmV3UHVzaC5rZXkoKTtcblxuICAvLyQucG9zdChgJHtGSVJFQkFTRV9VUkx9L3VzZXJzLyR7ZmIuZ2V0QXV0aCgpLnVpZH0vbW92aWVsaXN0Lmpzb24/YXV0aD0ke2ZiLmdldEF1dGgoKS50b2tlbn1gLCBKU09OLnN0cmluZ2lmeShvYmopLCBmdW5jdGlvbihyZXNwb25zZSkge1xuICAvLyAgb2JqLmRhdGFfaWQgPSByZXNwb25zZS5uYW1lO1xuICAvL30pXG59XG5cbmZ1bmN0aW9uIGRlbGV0ZUZyb21GaXJlYmFzZShpZCkge1xuICBtb3ZpZWxpc3QuY2hpbGQoaWQpLnNldChudWxsKTtcblxuICAvLyB2YXIgZGVsZXRlVXJsID0gYCR7RklSRUJBU0VfVVJMfS91c2Vycy8ke2ZiLmdldEF1dGgoKS51aWR9L21vdmllbGlzdC8ke2lkfS5qc29uP2F1dGg9JHtmYi5nZXRBdXRoKCkudG9rZW59YDtcbiAgLy8gJC5hamF4KHt1cmw6IGRlbGV0ZVVybCwgdHlwZTogJ0RFTEVURSd9KTtcbn1cblxuLy9mdW5jdGlvbiB0YWJsZUxvYWQoKSB7XG4vLyAgJC5nZXQoYCR7RklSRUJBU0VfVVJMfS91c2Vycy8ke2ZiLmdldEF1dGgoKS51aWR9L21vdmllbGlzdC5qc29uP2F1dGg9JHtmYi5nZXRBdXRoKCkudG9rZW59YCwgZnVuY3Rpb24oZGJfZGF0YSkge1xuLy8gICAgZGJfZGF0YSAmJiBfKGRiX2RhdGEpLmZvckVhY2goZnVuY3Rpb24odmFsdWUsIGtleSkge1xuLy8gICAgICBhZGRUb1RhYmxlKHZhbHVlLCBrZXkpO1xuLy8gICAgfSkudmFsdWUoKTtcbi8vICB9KVxuLy99XG4iXX0=
