"use strict";

var FIREBASE_URL = "https://movieagenda.firebaseio.com";
var fb = new Firebase(FIREBASE_URL);
var movielist;
var API_URL = "http://www.omdbapi.com/?t=";
var $SUBMITBUTTON = $(".submit");
var $TEXTFIELD = $(".textfield");
var $MOVIEINFO = $(".movie-info");
var $MOVIETABLECONTAINER = $(".movie-table-container");
var movie_info_obj;
var poster_url;
var TMDB_API_KEY = "?api_key=3d3efaa01fcce58b6e8758f0f9d9c93d";
var TMDB_SEARCH_URL = "http://api.themoviedb.org/3/search/movie";
var TMDB_POSTER_BASE = "http://image.tmdb.org/t/p/w500";
var TRAILER_API_URL = "http://crossorigin.me/http://api.traileraddict.com/?film=";

fb.onAuth(function (authData) {
  if (!authData && window.location.pathname !== "/movieagenda/login/") {
    window.location = "/movieagenda/login";
  } else if (authData) {
    // THE BELOW CODE DOES NOT WORK (if at top of code) BECAUSE:
    // if you *are* on the login page and aren't logged in, the program will *still*
    // take you to the saveAuthData function, execute the function, and throw an error when it tries to read
    // the uid of null (authData is null), *halting* execution of the rest of the script.
    // Page is still usable but the submit handler for "login" hasn't been executed/applied, so it'll just
    // do the default action and refresh the page; user still isn't logged in.
    // WILL WORK AT BOTTOM OF CODE BECAUSE:
    // By the time the error is thrown and the script halts, all the handlers have already
    // been applied (this handler would be the last thing executed, after all).
    // BUT IT MAKES MUCH MORE SENSE TO USE THE ABOVE CODE, WHICH PREVENTS THE ERROR IN QUESTION.
    // } else {
    saveAuthData(authData);
  }
  clearLoginForm();
});

if (window.location.pathname === "/movieagenda/table/") {
  $(".crumbs-left").append($("<p>Welcome, " + fb.getAuth().password.email.split("@")[0] + "!</p>"));
  movielist = fb.child("users/" + fb.getAuth().uid + "/movielist");
  // will add to user's table whenever a movie is added to FirebaseDB (occurs within)
  // submit button clickhandler.
  movielist.on("child_added", function (snapshot) {
    addToTable(snapshot.val(), snapshot.key());
  });
  // will remove from user's table whenever something is deleted from FirebaseDB
  // (occurs within delete button clickhandler) as written below:
  movielist.on("child_removed", function (snapshot) {
    $("[data_id='" + snapshot.key() + "']").fadeOut(500, function () {
      $(this).closest("tr").remove();
      if (!$("td").length) {
        $("table").remove();
      }
    });
  });
}

console.log("read to here");

$(".login-page form").submit(function (event) {
  console.log("clicked submit");
  event.preventDefault();
  var email = $(".login-page input[type=\"email\"]").val();
  var password = $(".login-page input[type=\"password\"]").val();

  doLogin(email, password);
});

$(".doLogout").click(function () {
  fb.unauth();
});

$(".doRegister").click(function (event) {
  event.preventDefault();
  var email = $(".login-page input[type=\"email\"]").val();
  var password = $(".login-page input[type=\"password\"]").val();

  fb.createUser({
    email: email,
    password: password
  }, function (err, userData) {
    if (err) {
      alert(err.toString());
    } else {
      doLogin(email, password);
    }
  });
});

$(".reset-password form").submit(function () {
  var email = fb.getAuth().password.email;
  var oldPw = $("#oldpass").val();
  var newPw = $("#newpass").val();

  fb.changePassword({
    email: email,
    oldPassword: oldPw,
    newPassword: newPw
  }, function (err) {
    if (err) {
      alert(err.toString());
    } else {
      fb.unauth();
    }
  });
  event.preventDefault();
});

$(".doResetPassword").click(function () {
  event.preventDefault();
  var email = $(".login-page input[type=\"email\"]").val();

  fb.resetPassword({
    email: email
  }, function (err) {
    if (err) {
      alert(err.toString());
    } else {
      alert("Please check your email for further instructions.");
    }
  });
});

function doLogin(email, password, callback) {
  console.log("logging in");
  fb.authWithPassword({
    email: email,
    password: password
  }, function (err, authData) {
    if (err) {
      alert(err.toString());
    } else {
      typeof callback === "function" && callback(authData);
    }
  });
}

function saveAuthData(authData) {
  console.log("saving auth data");
  var ref = fb.child("users/" + authData.uid + "/profile");
  ref.set(authData, postAuthRouting(authData));
}

function postAuthRouting(authData) {
  if (authData && authData.password.isTemporaryPassword && window.location.pathname !== "/movieagenda/resetpassword/") {
    window.location = "/movieagenda/resetpassword";
  } else if (authData && !authData.password.isTemporaryPassword && window.location.pathname !== "/movieagenda/table/") {
    window.location = "/movieagenda/table";
  }
}

//  $.ajax({
//     method: 'PUT',
//     url: `${FIREBASE_URL}/users/${authData.uid}/profile.json?auth=${fb.getAuth().token}`,
//     data: JSON.stringify(authData)
//  }).done(function() {
//    if (authData && authData.password.isTemporaryPassword && window.location.pathname !== "/resetpassword/") {
//      window.location = "/resetpassword";
//    } else if (authData && !authData.password.isTemporaryPassword && window.location.pathname !== "/table/") {
//      window.location = "/table";
//    }
//  });
// }

function clearLoginForm() {
  $(".login-page input[type=\"email\"]").val("");
  $(".login-page input[type=\"password\"]").val("");
}

function getSearchParams() {
  var movie_title = $TEXTFIELD.val();
  var search_params = movie_title.split(" ").join("+");
  return search_params;
}

$SUBMITBUTTON.click(function (event) {
  event.preventDefault();
  var tmdb_search_url = TMDB_SEARCH_URL + TMDB_API_KEY + "&query=" + getSearchParams();
  $.get(tmdb_search_url, setPosterUrl, "jsonp");
});

function setPosterUrl(obj) {
  if (obj.total_results === 0) {
    $MOVIEINFO.empty();
    $MOVIEINFO.append(makeError());
    setTimeout(function () {
      $(".error").fadeOut(500, function () {
        $(".error").remove();
      });
    }, 3000);
    return false;
  }
  var poster_path = obj.results && obj.results[0] && obj.results[0].poster_path;
  poster_url = TMDB_POSTER_BASE + poster_path + TMDB_API_KEY;
  // have the poster url; now get the rest of the data according to the title as it was return by the
  // object bearing the poster path (to keep consistency between both APIs' search results).
  var request_url = API_URL + (obj.results && obj.results[0] && obj.results[0].original_title.split(" ").join("+"));
  $.get(request_url, addMovieInfo, "jsonp");
}

$MOVIEINFO.on("click", ".add-button", function (event) {
  event.preventDefault();
  writeToFirebase(movie_info_obj);
});

$MOVIETABLECONTAINER.on("click", "button.watched-btn", function (event) {
  event.preventDefault();
  deleteFromFirebase($(this).closest("tr").attr("data_id"));
  // $(this).closest('tr').fadeOut(500, function() {
  //   $(this).closest('tr').remove();
  //   if (!($('td').length)) {
  //     $('table').remove();
  //   }
  // });
});

$(".movie-info, .movie-table-container").on("click", "button.trailer-btn", function (event) {
  event.preventDefault();
  var query = $(this).attr("query");
  $.get(TRAILER_API_URL + query + "&count=10", function (dataXML) {
    var trailer = $.parseXML(dataXML);
    var $embeds = $($(trailer).find("embed"));
    var vid_arr = $.map($embeds, function (embed) {
      return $(embed).text();
    });
    $.fancybox(vid_arr);
  });
});

$MOVIETABLECONTAINER.on("click", "img", function (event) {
  event.preventDefault();
  var id = $(this).closest("tr").attr("data_id");
  movielist.child(id).once("value", function (obj) {
    reClick(obj.val());
  });
});

// reClick is for reloading stored movies into the movie info view; don't need to rewrite the poster url.
function reClick(obj) {
  movie_info_obj = obj;
  $MOVIEINFO.empty();
  $MOVIEINFO.append(makeMovieInfo(obj));
}

function addMovieInfo(obj) {
  movie_info_obj = obj;
  movie_info_obj.Poster = poster_url;
  $MOVIEINFO.empty();
  $MOVIEINFO.append(makeMovieInfo(obj));
}

function makeError() {
  var $error = $("<div><p>(´Ａ｀。) No results!</p></div>");
  $error.addClass("error");
  return $error;
}

function makeMovieInfo(obj) {
  var $info_container = $("<div></div>");
  $info_container.addClass("info-container");
  var $title = $("<p>" + obj.Title + "</p>");
  var $info = $(makeRatingImgText(obj) + "<button class='trailer-btn btn btn-sm btn-default' query='" + obj.Title.replace(/[\.,-\/#!$%\^&\*;:{}=\-_`~()]/g, "").split(" ").join("-") + "'>View clips</button><span " + makeMetaRatingText(obj) + "</span><p class='imdb-rating'>" + obj.imdbRating + "</p></span><span>&nbsp" + obj.Year + "</span><span>&nbsp&nbsp&nbsp" + obj.Runtime + "</span>");
  $title.addClass("title");
  var $director = $("<p>Director: " + obj.Director + "</p>");
  var $plot = $("<p>" + obj.Plot + "</p>");
  var $add_button = $("<button>Add to my list</button>");
  $add_button.addClass("add-button btn btn-lg btn-success pull-right");

  var $poster = $("<img src='" + obj.Poster + "'></img>");
  $poster.addClass("pull-left");
  $info_container.append($poster);
  $info_container.append($title).append($info).append($director).append($plot).append($add_button);
  return $info_container;
}

function addToTable(obj, id) {
  if (!$("table").length) {
    $MOVIETABLECONTAINER.append(makeTableHeader());
  }
  $("table").append(makeTableRow(obj, id));
}

function makeTableHeader() {
  var $table = $("<table></table>");
  $table.addClass("table table-striped");
  var $header_row = $("<tr></tr>");
  var $header_elements = $("<th></th><th>Title</th><th>Year</th><th>Rating</th><th>Clips</th><th>Metascore</th><th>imdb</th><th></th>");
  $header_row.append($header_elements);
  $table.append($header_row);
  return $table;
}

function makeTableRow(obj, id) {
  var $row = $("<tr></tr>");
  var $poster_td;
  $row.attr("data_id", id || obj.data_id);
  obj.Poster === "N/A" ? $poster_td = $("<td><img src='" + "https://www.utopolis.lu/bundles/utopoliscommon/images/movies/movie-placeholder.jpg" + "'></td>") : $poster_td = $("<td><img src='" + obj.Poster + "'></src>");
  var other_rows = "<td>" + obj.Title + "</td><td>" + obj.Year + "</td><td>";
  other_rows += makeRatingImgText(obj);
  other_rows += "</td>";
  other_rows += "<td><button class='trailer-btn' query='" + obj.Title.replace(/[\.,-\/#!$%\^&\*;:{}=\-_`~()]/g, "").split(" ").join("-") + "'>View</button>";
  other_rows += "<td><p " + makeMetaRatingText(obj) + "</p></td>";
  other_rows += "<td><p class='imdb-rating'>" + obj.imdbRating + "</p></td>";
  other_rows += "<td><button class='watched-btn'>Watched</button></td>";
  var $other_rows = $(other_rows);
  $other_rows.find("button.watched-btn").addClass("btn btn-md btn-danger");
  $other_rows.find("button.trailer-btn").addClass("btn btn-md btn-default");
  $row.append($poster_td).append($other_rows);
  return $row;
}

function makeMetaRatingText(obj) {
  var return_str = "class='metascore ";
  if (parseInt(obj.Metascore) > 60) {
    return_str += "meta-positive";
  } else if (parseInt(obj.Metascore) > 39) {
    return_str += "meta-neutral";
  } else if (parseInt(obj.Metascore) >= 0) {
    return_str += "meta-negative";
  }
  return_str += "'>" + obj.Metascore;
  return return_str;
}

function makeRatingImgText(obj) {
  if (obj.Rated === "G") {
    return "<img class='rating-img' src='../images/G.svg'>";
  } else if (obj.Rated === "PG") {
    return "<img class='rating-img' src='../images/PG.svg'>";
  } else if (obj.Rated === "PG-13") {
    return "<img class='rating-img' src='../images/PG-13.svg'>";
  } else if (obj.Rated === "R") {
    return "<img class='rating-img' src='../images/R.svg'>";
  } else if (obj.Rated === "NC-17") {
    return "<img class='rating-img' src='../images/NC-17.svg'>";
  } else {
    return "<span>N/A</span>";
  }
}

function writeToFirebase(obj) {
  var newPush = movielist.push(obj);
  obj.data_id = newPush.key();

  //$.post(`${FIREBASE_URL}/users/${fb.getAuth().uid}/movielist.json?auth=${fb.getAuth().token}`, JSON.stringify(obj), function(response) {
  //  obj.data_id = response.name;
  //})
}

function deleteFromFirebase(id) {
  movielist.child(id).set(null);

  // var deleteUrl = `${FIREBASE_URL}/users/${fb.getAuth().uid}/movielist/${id}.json?auth=${fb.getAuth().token}`;
  // $.ajax({url: deleteUrl, type: 'DELETE'});
}

//function tableLoad() {
//  $.get(`${FIREBASE_URL}/users/${fb.getAuth().uid}/movielist.json?auth=${fb.getAuth().token}`, function(db_data) {
//    db_data && _(db_data).forEach(function(value, key) {
//      addToTable(value, key);
//    }).value();
//  })
//}
//   var token = fb.getAuth().token;
//   $.get(`${FIREBASE_URL}/users/${fb.getAuth().uid}/movielist/${id}.json?auth=${token}`, reClick, "jsonp");
//# sourceMappingURL=data:application/json;base64,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QUFLLEtBQUssR0FBRyxFQUFFO0FBQzVCLFdBQU8sZ0RBQWdELENBQUM7R0FDekQsTUFBTSxJQUFJLEdBQUcsQ0FBQyxLQUFLLEtBQUssT0FBTyxFQUFFO0FBQ2hDLFdBQU8sb0RBQW9ELENBQUM7R0FDN0QsTUFBTTtBQUNMLFdBQU8sa0JBQWtCLENBQUE7R0FDMUI7Q0FDRjs7QUFFRCxTQUFTLGVBQWUsQ0FBQyxHQUFHLEVBQUU7QUFDNUIsTUFBSSxPQUFPLEdBQUcsU0FBUyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUNsQyxLQUFHLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQzs7Ozs7Q0FLN0I7O0FBRUQsU0FBUyxrQkFBa0IsQ0FBQyxFQUFFLEVBQUU7QUFDOUIsV0FBUyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7Ozs7Q0FJL0I7Ozs7Ozs7OztBQUFBIiwiZmlsZSI6InNyYy9qcy9tYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIEZJUkVCQVNFX1VSTCA9IFwiaHR0cHM6Ly9tb3ZpZWFnZW5kYS5maXJlYmFzZWlvLmNvbVwiO1xudmFyIGZiID0gbmV3IEZpcmViYXNlKEZJUkVCQVNFX1VSTCk7XG52YXIgbW92aWVsaXN0O1xudmFyIEFQSV9VUkwgPSBcImh0dHA6Ly93d3cub21kYmFwaS5jb20vP3Q9XCI7XG52YXIgJFNVQk1JVEJVVFRPTiA9ICQoXCIuc3VibWl0XCIpO1xudmFyICRURVhURklFTEQgPSAkKFwiLnRleHRmaWVsZFwiKTtcbnZhciAkTU9WSUVJTkZPID0gJChcIi5tb3ZpZS1pbmZvXCIpO1xudmFyICRNT1ZJRVRBQkxFQ09OVEFJTkVSID0gJChcIi5tb3ZpZS10YWJsZS1jb250YWluZXJcIik7XG52YXIgbW92aWVfaW5mb19vYmo7XG52YXIgcG9zdGVyX3VybDtcbnZhciBUTURCX0FQSV9LRVkgPSBcIj9hcGlfa2V5PTNkM2VmYWEwMWZjY2U1OGI2ZTg3NThmMGY5ZDljOTNkXCI7XG52YXIgVE1EQl9TRUFSQ0hfVVJMID0gXCJodHRwOi8vYXBpLnRoZW1vdmllZGIub3JnLzMvc2VhcmNoL21vdmllXCI7XG52YXIgVE1EQl9QT1NURVJfQkFTRSA9IFwiaHR0cDovL2ltYWdlLnRtZGIub3JnL3QvcC93NTAwXCI7XG52YXIgVFJBSUxFUl9BUElfVVJMID0gXCJodHRwOi8vY3Jvc3NvcmlnaW4ubWUvaHR0cDovL2FwaS50cmFpbGVyYWRkaWN0LmNvbS8/ZmlsbT1cIjtcblxuZmIub25BdXRoKGZ1bmN0aW9uKGF1dGhEYXRhKSB7XG4gIGlmICghYXV0aERhdGEgJiYgd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lICE9PSBcIi9tb3ZpZWFnZW5kYS9sb2dpbi9cIil7XG4gICAgd2luZG93LmxvY2F0aW9uID0gXCIvbW92aWVhZ2VuZGEvbG9naW5cIjtcbiAgfSBlbHNlIGlmIChhdXRoRGF0YSkge1xuLy8gVEhFIEJFTE9XIENPREUgRE9FUyBOT1QgV09SSyAoaWYgYXQgdG9wIG9mIGNvZGUpIEJFQ0FVU0U6XG4vLyBpZiB5b3UgKmFyZSogb24gdGhlIGxvZ2luIHBhZ2UgYW5kIGFyZW4ndCBsb2dnZWQgaW4sIHRoZSBwcm9ncmFtIHdpbGwgKnN0aWxsKlxuLy8gdGFrZSB5b3UgdG8gdGhlIHNhdmVBdXRoRGF0YSBmdW5jdGlvbiwgZXhlY3V0ZSB0aGUgZnVuY3Rpb24sIGFuZCB0aHJvdyBhbiBlcnJvciB3aGVuIGl0IHRyaWVzIHRvIHJlYWRcbi8vIHRoZSB1aWQgb2YgbnVsbCAoYXV0aERhdGEgaXMgbnVsbCksICpoYWx0aW5nKiBleGVjdXRpb24gb2YgdGhlIHJlc3Qgb2YgdGhlIHNjcmlwdC5cbi8vIFBhZ2UgaXMgc3RpbGwgdXNhYmxlIGJ1dCB0aGUgc3VibWl0IGhhbmRsZXIgZm9yIFwibG9naW5cIiBoYXNuJ3QgYmVlbiBleGVjdXRlZC9hcHBsaWVkLCBzbyBpdCdsbCBqdXN0XG4vLyBkbyB0aGUgZGVmYXVsdCBhY3Rpb24gYW5kIHJlZnJlc2ggdGhlIHBhZ2U7IHVzZXIgc3RpbGwgaXNuJ3QgbG9nZ2VkIGluLlxuLy8gV0lMTCBXT1JLIEFUIEJPVFRPTSBPRiBDT0RFIEJFQ0FVU0U6XG4vLyBCeSB0aGUgdGltZSB0aGUgZXJyb3IgaXMgdGhyb3duIGFuZCB0aGUgc2NyaXB0IGhhbHRzLCBhbGwgdGhlIGhhbmRsZXJzIGhhdmUgYWxyZWFkeVxuLy8gYmVlbiBhcHBsaWVkICh0aGlzIGhhbmRsZXIgd291bGQgYmUgdGhlIGxhc3QgdGhpbmcgZXhlY3V0ZWQsIGFmdGVyIGFsbCkuXG4vLyBCVVQgSVQgTUFLRVMgTVVDSCBNT1JFIFNFTlNFIFRPIFVTRSBUSEUgQUJPVkUgQ09ERSwgV0hJQ0ggUFJFVkVOVFMgVEhFIEVSUk9SIElOIFFVRVNUSU9OLlxuLy8gfSBlbHNlIHtcbiAgICBzYXZlQXV0aERhdGEoYXV0aERhdGEpO1xuICB9XG4gIGNsZWFyTG9naW5Gb3JtKCk7XG59KTtcblxuaWYgKHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSA9PT0gXCIvbW92aWVhZ2VuZGEvdGFibGUvXCIpIHtcbiAgJCgnLmNydW1icy1sZWZ0JykuYXBwZW5kKCQoYDxwPldlbGNvbWUsICR7ZmIuZ2V0QXV0aCgpLnBhc3N3b3JkLmVtYWlsLnNwbGl0KFwiQFwiKVswXX0hPC9wPmApKVxuICBtb3ZpZWxpc3QgPSBmYi5jaGlsZChgdXNlcnMvJHtmYi5nZXRBdXRoKCkudWlkfS9tb3ZpZWxpc3RgKTtcbiAgLy8gd2lsbCBhZGQgdG8gdXNlcidzIHRhYmxlIHdoZW5ldmVyIGEgbW92aWUgaXMgYWRkZWQgdG8gRmlyZWJhc2VEQiAob2NjdXJzIHdpdGhpbilcbiAgLy8gc3VibWl0IGJ1dHRvbiBjbGlja2hhbmRsZXIuXG4gIG1vdmllbGlzdC5vbignY2hpbGRfYWRkZWQnLCBmdW5jdGlvbihzbmFwc2hvdCkge1xuICAgIGFkZFRvVGFibGUoc25hcHNob3QudmFsKCksIHNuYXBzaG90LmtleSgpKTtcbiAgfSk7XG4gIC8vIHdpbGwgcmVtb3ZlIGZyb20gdXNlcidzIHRhYmxlIHdoZW5ldmVyIHNvbWV0aGluZyBpcyBkZWxldGVkIGZyb20gRmlyZWJhc2VEQlxuICAvLyAob2NjdXJzIHdpdGhpbiBkZWxldGUgYnV0dG9uIGNsaWNraGFuZGxlcikgYXMgd3JpdHRlbiBiZWxvdzpcbiAgbW92aWVsaXN0Lm9uKCdjaGlsZF9yZW1vdmVkJywgZnVuY3Rpb24oc25hcHNob3QpIHtcbiAgICAkKFwiW2RhdGFfaWQ9J1wiICsgc25hcHNob3Qua2V5KCkgKyBcIiddXCIpLmZhZGVPdXQoNTAwLCBmdW5jdGlvbigpIHtcbiAgICAgICQodGhpcykuY2xvc2VzdCgndHInKS5yZW1vdmUoKTtcbiAgICAgICAgaWYgKCEoJCgndGQnKS5sZW5ndGgpKSB7XG4gICAgICAgICAgJCgndGFibGUnKS5yZW1vdmUoKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICB9KTtcbn1cblxuY29uc29sZS5sb2coXCJyZWFkIHRvIGhlcmVcIik7XG5cbiQoJy5sb2dpbi1wYWdlIGZvcm0nKS5zdWJtaXQoZnVuY3Rpb24oZXZlbnQpIHtcbiAgY29uc29sZS5sb2coXCJjbGlja2VkIHN1Ym1pdFwiKTtcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgdmFyIGVtYWlsID0gJCgnLmxvZ2luLXBhZ2UgaW5wdXRbdHlwZT1cImVtYWlsXCJdJykudmFsKCk7XG4gIHZhciBwYXNzd29yZCA9ICQoJy5sb2dpbi1wYWdlIGlucHV0W3R5cGU9XCJwYXNzd29yZFwiXScpLnZhbCgpO1xuXG4gIGRvTG9naW4oZW1haWwsIHBhc3N3b3JkKTtcbn0pO1xuXG4kKCcuZG9Mb2dvdXQnKS5jbGljayhmdW5jdGlvbigpIHtcbiAgZmIudW5hdXRoKCk7XG59KVxuXG4kKCcuZG9SZWdpc3RlcicpLmNsaWNrKGZ1bmN0aW9uKGV2ZW50KSB7XG4gIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gIHZhciBlbWFpbCA9ICQoJy5sb2dpbi1wYWdlIGlucHV0W3R5cGU9XCJlbWFpbFwiXScpLnZhbCgpO1xuICB2YXIgcGFzc3dvcmQgPSAkKCcubG9naW4tcGFnZSBpbnB1dFt0eXBlPVwicGFzc3dvcmRcIl0nKS52YWwoKTtcblxuICBmYi5jcmVhdGVVc2VyKHtcbiAgICBlbWFpbDogZW1haWwsXG4gICAgcGFzc3dvcmQ6IHBhc3N3b3JkXG4gIH0sIGZ1bmN0aW9uKGVyciwgdXNlckRhdGEpIHtcbiAgICBpZiAoZXJyKSB7XG4gICAgICBhbGVydChlcnIudG9TdHJpbmcoKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRvTG9naW4oZW1haWwsIHBhc3N3b3JkKTtcbiAgICB9XG4gIH0pO1xufSlcblxuJCgnLnJlc2V0LXBhc3N3b3JkIGZvcm0nKS5zdWJtaXQoZnVuY3Rpb24oKSB7XG4gIHZhciBlbWFpbCA9IGZiLmdldEF1dGgoKS5wYXNzd29yZC5lbWFpbDtcbiAgdmFyIG9sZFB3ID0gJCgnI29sZHBhc3MnKS52YWwoKTtcbiAgdmFyIG5ld1B3ID0gJCgnI25ld3Bhc3MnKS52YWwoKTtcblxuICBmYi5jaGFuZ2VQYXNzd29yZCh7XG4gICAgZW1haWw6IGVtYWlsLFxuICAgIG9sZFBhc3N3b3JkOiBvbGRQdyxcbiAgICBuZXdQYXNzd29yZDogbmV3UHdcbiAgfSwgZnVuY3Rpb24oZXJyKSB7XG4gICAgaWYgKGVycikge1xuICAgICAgYWxlcnQoZXJyLnRvU3RyaW5nKCkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBmYi51bmF1dGgoKTtcbiAgICB9XG4gIH0pO1xuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xufSk7XG5cbiQoJy5kb1Jlc2V0UGFzc3dvcmQnKS5jbGljayhmdW5jdGlvbigpIHtcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgdmFyIGVtYWlsID0gJCgnLmxvZ2luLXBhZ2UgaW5wdXRbdHlwZT1cImVtYWlsXCJdJykudmFsKCk7XG5cbiAgZmIucmVzZXRQYXNzd29yZCh7XG4gICAgZW1haWw6IGVtYWlsXG4gIH0sIGZ1bmN0aW9uKGVycikge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIGFsZXJ0KGVyci50b1N0cmluZygpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYWxlcnQoXCJQbGVhc2UgY2hlY2sgeW91ciBlbWFpbCBmb3IgZnVydGhlciBpbnN0cnVjdGlvbnMuXCIpO1xuICAgIH1cbiAgfSk7XG59KTtcblxuZnVuY3Rpb24gZG9Mb2dpbihlbWFpbCwgcGFzc3dvcmQsIGNhbGxiYWNrKSB7XG4gIGNvbnNvbGUubG9nKFwibG9nZ2luZyBpblwiKTtcbiAgZmIuYXV0aFdpdGhQYXNzd29yZCh7XG4gICAgZW1haWw6IGVtYWlsLFxuICAgIHBhc3N3b3JkOiBwYXNzd29yZFxuICB9LCBmdW5jdGlvbihlcnIsIGF1dGhEYXRhKXtcbiAgICBpZiAoZXJyKSB7XG4gICAgICBhbGVydChlcnIudG9TdHJpbmcoKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJyAmJiBjYWxsYmFjayhhdXRoRGF0YSk7XG4gICAgfVxuICB9KTtcbn1cblxuZnVuY3Rpb24gc2F2ZUF1dGhEYXRhIChhdXRoRGF0YSkge1xuICBjb25zb2xlLmxvZyhcInNhdmluZyBhdXRoIGRhdGFcIik7XG4gIHZhciByZWYgPSBmYi5jaGlsZChgdXNlcnMvJHthdXRoRGF0YS51aWR9L3Byb2ZpbGVgKTtcbiAgcmVmLnNldChhdXRoRGF0YSwgcG9zdEF1dGhSb3V0aW5nKGF1dGhEYXRhKSk7XG59XG5cbmZ1bmN0aW9uIHBvc3RBdXRoUm91dGluZyhhdXRoRGF0YSkge1xuICBpZiAoYXV0aERhdGEgJiYgYXV0aERhdGEucGFzc3dvcmQuaXNUZW1wb3JhcnlQYXNzd29yZCAmJiB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUgIT09IFwiL21vdmllYWdlbmRhL3Jlc2V0cGFzc3dvcmQvXCIpIHtcbiAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IFwiL21vdmllYWdlbmRhL3Jlc2V0cGFzc3dvcmRcIjtcbiAgICB9IGVsc2UgaWYgKGF1dGhEYXRhICYmICFhdXRoRGF0YS5wYXNzd29yZC5pc1RlbXBvcmFyeVBhc3N3b3JkICYmIHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZSAhPT0gXCIvbW92aWVhZ2VuZGEvdGFibGUvXCIpIHtcbiAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IFwiL21vdmllYWdlbmRhL3RhYmxlXCI7XG4gICAgfVxufVxuXG4vLyAgJC5hamF4KHtcbi8vICAgICBtZXRob2Q6ICdQVVQnLFxuLy8gICAgIHVybDogYCR7RklSRUJBU0VfVVJMfS91c2Vycy8ke2F1dGhEYXRhLnVpZH0vcHJvZmlsZS5qc29uP2F1dGg9JHtmYi5nZXRBdXRoKCkudG9rZW59YCxcbi8vICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeShhdXRoRGF0YSlcbi8vICB9KS5kb25lKGZ1bmN0aW9uKCkge1xuLy8gICAgaWYgKGF1dGhEYXRhICYmIGF1dGhEYXRhLnBhc3N3b3JkLmlzVGVtcG9yYXJ5UGFzc3dvcmQgJiYgd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lICE9PSBcIi9yZXNldHBhc3N3b3JkL1wiKSB7XG4vLyAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IFwiL3Jlc2V0cGFzc3dvcmRcIjtcbi8vICAgIH0gZWxzZSBpZiAoYXV0aERhdGEgJiYgIWF1dGhEYXRhLnBhc3N3b3JkLmlzVGVtcG9yYXJ5UGFzc3dvcmQgJiYgd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lICE9PSBcIi90YWJsZS9cIikge1xuLy8gICAgICB3aW5kb3cubG9jYXRpb24gPSBcIi90YWJsZVwiO1xuLy8gICAgfVxuLy8gIH0pO1xuLy8gfVxuXG5mdW5jdGlvbiBjbGVhckxvZ2luRm9ybSgpIHtcbiAgJCgnLmxvZ2luLXBhZ2UgaW5wdXRbdHlwZT1cImVtYWlsXCJdJykudmFsKCcnKTtcbiAgJCgnLmxvZ2luLXBhZ2UgaW5wdXRbdHlwZT1cInBhc3N3b3JkXCJdJykudmFsKCcnKTtcbn1cblxuZnVuY3Rpb24gZ2V0U2VhcmNoUGFyYW1zKCkge1xuICB2YXIgbW92aWVfdGl0bGUgPSAkVEVYVEZJRUxELnZhbCgpO1xuICB2YXIgc2VhcmNoX3BhcmFtcyA9IG1vdmllX3RpdGxlLnNwbGl0KFwiIFwiKS5qb2luKFwiK1wiKTtcbiAgcmV0dXJuIHNlYXJjaF9wYXJhbXM7XG59XG5cbiRTVUJNSVRCVVRUT04uY2xpY2soZnVuY3Rpb24oZXZlbnQpIHtcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgdmFyIHRtZGJfc2VhcmNoX3VybCA9IFRNREJfU0VBUkNIX1VSTCArIFRNREJfQVBJX0tFWSArIFwiJnF1ZXJ5PVwiICsgZ2V0U2VhcmNoUGFyYW1zKCk7XG4gICQuZ2V0KHRtZGJfc2VhcmNoX3VybCwgc2V0UG9zdGVyVXJsLCAnanNvbnAnKTtcbn0pXG5cbmZ1bmN0aW9uIHNldFBvc3RlclVybChvYmopIHtcbiAgaWYgKG9iai50b3RhbF9yZXN1bHRzID09PSAwKSB7XG4gICAgJE1PVklFSU5GTy5lbXB0eSgpO1xuICAgICRNT1ZJRUlORk8uYXBwZW5kKG1ha2VFcnJvcigpKTtcbiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgJChcIi5lcnJvclwiKS5mYWRlT3V0KDUwMCwgZnVuY3Rpb24oKSB7XG4gICAgICAgICQoXCIuZXJyb3JcIikucmVtb3ZlKCk7XG4gICAgICB9KVxuICAgIH0sIDMwMDApXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIHZhciBwb3N0ZXJfcGF0aCA9IG9iai5yZXN1bHRzICYmIG9iai5yZXN1bHRzWzBdICYmIG9iai5yZXN1bHRzWzBdLnBvc3Rlcl9wYXRoO1xuICBwb3N0ZXJfdXJsID0gVE1EQl9QT1NURVJfQkFTRSArIHBvc3Rlcl9wYXRoICsgVE1EQl9BUElfS0VZO1xuICAvLyBoYXZlIHRoZSBwb3N0ZXIgdXJsOyBub3cgZ2V0IHRoZSByZXN0IG9mIHRoZSBkYXRhIGFjY29yZGluZyB0byB0aGUgdGl0bGUgYXMgaXQgd2FzIHJldHVybiBieSB0aGVcbiAgLy8gb2JqZWN0IGJlYXJpbmcgdGhlIHBvc3RlciBwYXRoICh0byBrZWVwIGNvbnNpc3RlbmN5IGJldHdlZW4gYm90aCBBUElzJyBzZWFyY2ggcmVzdWx0cykuXG4gIHZhciByZXF1ZXN0X3VybCA9IEFQSV9VUkwgKyAob2JqLnJlc3VsdHMgJiYgb2JqLnJlc3VsdHNbMF0gJiYgb2JqLnJlc3VsdHNbMF0ub3JpZ2luYWxfdGl0bGUuc3BsaXQoXCIgXCIpLmpvaW4oXCIrXCIpKTtcbiAgJC5nZXQocmVxdWVzdF91cmwsIGFkZE1vdmllSW5mbywgJ2pzb25wJyk7XG59XG5cbiRNT1ZJRUlORk8ub24oJ2NsaWNrJywgJy5hZGQtYnV0dG9uJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgd3JpdGVUb0ZpcmViYXNlKG1vdmllX2luZm9fb2JqKTtcbn0pXG5cbiRNT1ZJRVRBQkxFQ09OVEFJTkVSLm9uKCdjbGljaycsICdidXR0b24ud2F0Y2hlZC1idG4nLCBmdW5jdGlvbihldmVudCkge1xuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICBkZWxldGVGcm9tRmlyZWJhc2UoJCh0aGlzKS5jbG9zZXN0KCd0cicpLmF0dHIoJ2RhdGFfaWQnKSk7XG4gIC8vICQodGhpcykuY2xvc2VzdCgndHInKS5mYWRlT3V0KDUwMCwgZnVuY3Rpb24oKSB7XG4gIC8vICAgJCh0aGlzKS5jbG9zZXN0KCd0cicpLnJlbW92ZSgpO1xuICAvLyAgIGlmICghKCQoJ3RkJykubGVuZ3RoKSkge1xuICAvLyAgICAgJCgndGFibGUnKS5yZW1vdmUoKTtcbiAgLy8gICB9XG4gIC8vIH0pO1xufSlcblxuJCgnLm1vdmllLWluZm8sIC5tb3ZpZS10YWJsZS1jb250YWluZXInKS5vbignY2xpY2snLCAnYnV0dG9uLnRyYWlsZXItYnRuJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgdmFyIHF1ZXJ5ID0gJCh0aGlzKS5hdHRyKCdxdWVyeScpO1xuICAkLmdldChUUkFJTEVSX0FQSV9VUkwgKyBxdWVyeSArIFwiJmNvdW50PTEwXCIsIGZ1bmN0aW9uIChkYXRhWE1MKSB7XG4gICAgdmFyIHRyYWlsZXIgPSAkLnBhcnNlWE1MKGRhdGFYTUwpO1xuICAgIHZhciAkZW1iZWRzID0gJCgkKHRyYWlsZXIpLmZpbmQoJ2VtYmVkJykpO1xuICAgIHZhciB2aWRfYXJyID0gJC5tYXAoJGVtYmVkcywgZnVuY3Rpb24oZW1iZWQpIHtcbiAgICAgIHJldHVybiAkKGVtYmVkKS50ZXh0KCk7XG4gICAgfSlcbiAgICAkLmZhbmN5Ym94KHZpZF9hcnIpO1xuICB9KVxufSlcblxuJE1PVklFVEFCTEVDT05UQUlORVIub24oJ2NsaWNrJywgJ2ltZycsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gIHZhciBpZCA9ICQodGhpcykuY2xvc2VzdCgndHInKS5hdHRyKCdkYXRhX2lkJyk7XG4gIG1vdmllbGlzdC5jaGlsZChpZCkub25jZShcInZhbHVlXCIsIGZ1bmN0aW9uKG9iaikge1xuICAgIHJlQ2xpY2sob2JqLnZhbCgpKTtcbiAgfSlcbi8vICAgdmFyIHRva2VuID0gZmIuZ2V0QXV0aCgpLnRva2VuO1xuLy8gICAkLmdldChgJHtGSVJFQkFTRV9VUkx9L3VzZXJzLyR7ZmIuZ2V0QXV0aCgpLnVpZH0vbW92aWVsaXN0LyR7aWR9Lmpzb24/YXV0aD0ke3Rva2VufWAsIHJlQ2xpY2ssIFwianNvbnBcIik7XG59KVxuXG4vLyByZUNsaWNrIGlzIGZvciByZWxvYWRpbmcgc3RvcmVkIG1vdmllcyBpbnRvIHRoZSBtb3ZpZSBpbmZvIHZpZXc7IGRvbid0IG5lZWQgdG8gcmV3cml0ZSB0aGUgcG9zdGVyIHVybC5cbmZ1bmN0aW9uIHJlQ2xpY2sob2JqKSB7XG4gIG1vdmllX2luZm9fb2JqID0gb2JqO1xuICAkTU9WSUVJTkZPLmVtcHR5KCk7XG4gICRNT1ZJRUlORk8uYXBwZW5kKG1ha2VNb3ZpZUluZm8ob2JqKSk7XG59XG5cbmZ1bmN0aW9uIGFkZE1vdmllSW5mbyhvYmopIHtcbiAgbW92aWVfaW5mb19vYmogPSBvYmo7XG4gIG1vdmllX2luZm9fb2JqLlBvc3RlciA9IHBvc3Rlcl91cmw7XG4gICRNT1ZJRUlORk8uZW1wdHkoKTtcbiAgJE1PVklFSU5GTy5hcHBlbmQobWFrZU1vdmllSW5mbyhvYmopKTtcbn1cblxuZnVuY3Rpb24gbWFrZUVycm9yKCkge1xuICB2YXIgJGVycm9yID0gJCgnPGRpdj48cD4owrTvvKHvvYDjgIIpIE5vIHJlc3VsdHMhPC9wPjwvZGl2PicpXG4gICRlcnJvci5hZGRDbGFzcyhcImVycm9yXCIpO1xuICByZXR1cm4gJGVycm9yO1xufVxuXG5mdW5jdGlvbiBtYWtlTW92aWVJbmZvKG9iaikge1xuICB2YXIgJGluZm9fY29udGFpbmVyID0gJCgnPGRpdj48L2Rpdj4nKTtcbiAgJGluZm9fY29udGFpbmVyLmFkZENsYXNzKFwiaW5mby1jb250YWluZXJcIik7XG4gIHZhciAkdGl0bGUgPSAkKFwiPHA+XCIgKyBvYmouVGl0bGUgKyBcIjwvcD5cIik7XG4gIHZhciAkaW5mbyA9ICQobWFrZVJhdGluZ0ltZ1RleHQob2JqKSArIFwiPGJ1dHRvbiBjbGFzcz0ndHJhaWxlci1idG4gYnRuIGJ0bi1zbSBidG4tZGVmYXVsdCcgcXVlcnk9J1wiICsgb2JqLlRpdGxlLnJlcGxhY2UoL1tcXC4sLVxcLyMhJCVcXF4mXFwqOzp7fT1cXC1fYH4oKV0vZyxcIlwiKS5zcGxpdChcIiBcIikuam9pbihcIi1cIikgKyBcIic+VmlldyBjbGlwczwvYnV0dG9uPjxzcGFuIFwiICsgbWFrZU1ldGFSYXRpbmdUZXh0KG9iaikgKyBcIjwvc3Bhbj48cCBjbGFzcz0naW1kYi1yYXRpbmcnPlwiICsgb2JqLmltZGJSYXRpbmcgKyBcIjwvcD48L3NwYW4+PHNwYW4+Jm5ic3BcIiArIG9iai5ZZWFyICsgXCI8L3NwYW4+PHNwYW4+Jm5ic3AmbmJzcCZuYnNwXCIgKyBvYmouUnVudGltZSArIFwiPC9zcGFuPlwiKTtcbiAgJHRpdGxlLmFkZENsYXNzKFwidGl0bGVcIik7XG4gIHZhciAkZGlyZWN0b3IgPSAkKFwiPHA+RGlyZWN0b3I6IFwiICsgb2JqLkRpcmVjdG9yICsgXCI8L3A+XCIpO1xuICB2YXIgJHBsb3QgPSAkKFwiPHA+XCIgKyBvYmouUGxvdCArIFwiPC9wPlwiKTtcbiAgdmFyICRhZGRfYnV0dG9uID0gJChcIjxidXR0b24+QWRkIHRvIG15IGxpc3Q8L2J1dHRvbj5cIik7XG4gICRhZGRfYnV0dG9uLmFkZENsYXNzKFwiYWRkLWJ1dHRvbiBidG4gYnRuLWxnIGJ0bi1zdWNjZXNzIHB1bGwtcmlnaHRcIik7XG5cbiAgdmFyICRwb3N0ZXIgPSAkKFwiPGltZyBzcmM9J1wiICsgb2JqLlBvc3RlciArIFwiJz48L2ltZz5cIik7XG4gICRwb3N0ZXIuYWRkQ2xhc3MoXCJwdWxsLWxlZnRcIik7XG4gICRpbmZvX2NvbnRhaW5lci5hcHBlbmQoJHBvc3Rlcik7XG4gICRpbmZvX2NvbnRhaW5lci5hcHBlbmQoJHRpdGxlKS5hcHBlbmQoJGluZm8pLmFwcGVuZCgkZGlyZWN0b3IpLmFwcGVuZCgkcGxvdCkuYXBwZW5kKCRhZGRfYnV0dG9uKTtcbiAgcmV0dXJuICRpbmZvX2NvbnRhaW5lcjtcbn1cblxuZnVuY3Rpb24gYWRkVG9UYWJsZShvYmosIGlkKSB7XG4gIGlmICghKCQoXCJ0YWJsZVwiKS5sZW5ndGgpKSB7XG4gICAgJE1PVklFVEFCTEVDT05UQUlORVIuYXBwZW5kKG1ha2VUYWJsZUhlYWRlcigpKTtcbiAgfVxuICAkKFwidGFibGVcIikuYXBwZW5kKG1ha2VUYWJsZVJvdyhvYmosIGlkKSk7XG59XG5cbmZ1bmN0aW9uIG1ha2VUYWJsZUhlYWRlcigpIHtcbiAgdmFyICR0YWJsZT0gJChcIjx0YWJsZT48L3RhYmxlPlwiKTtcbiAgJHRhYmxlLmFkZENsYXNzKFwidGFibGUgdGFibGUtc3RyaXBlZFwiKTtcbiAgdmFyICRoZWFkZXJfcm93ID0gJChcIjx0cj48L3RyPlwiKTtcbiAgdmFyICRoZWFkZXJfZWxlbWVudHMgPSAkKFwiPHRoPjwvdGg+PHRoPlRpdGxlPC90aD48dGg+WWVhcjwvdGg+PHRoPlJhdGluZzwvdGg+PHRoPkNsaXBzPC90aD48dGg+TWV0YXNjb3JlPC90aD48dGg+aW1kYjwvdGg+PHRoPjwvdGg+XCIpO1xuICAkaGVhZGVyX3Jvdy5hcHBlbmQoJGhlYWRlcl9lbGVtZW50cyk7XG4gICR0YWJsZS5hcHBlbmQoJGhlYWRlcl9yb3cpO1xuICByZXR1cm4gJHRhYmxlO1xufVxuXG5mdW5jdGlvbiBtYWtlVGFibGVSb3cob2JqLCBpZCkge1xuICB2YXIgJHJvdyA9ICQoXCI8dHI+PC90cj5cIik7XG4gIHZhciAkcG9zdGVyX3RkO1xuICAkcm93LmF0dHIoXCJkYXRhX2lkXCIsIGlkIHx8IG9iai5kYXRhX2lkKTtcbiAgb2JqLlBvc3RlciA9PT0gXCJOL0FcIiA/ICRwb3N0ZXJfdGQgPSAkKFwiPHRkPjxpbWcgc3JjPSdcIiArIFwiaHR0cHM6Ly93d3cudXRvcG9saXMubHUvYnVuZGxlcy91dG9wb2xpc2NvbW1vbi9pbWFnZXMvbW92aWVzL21vdmllLXBsYWNlaG9sZGVyLmpwZ1wiICsgXCInPjwvdGQ+XCIpIDogJHBvc3Rlcl90ZCA9ICQoXCI8dGQ+PGltZyBzcmM9J1wiICsgb2JqLlBvc3RlciArIFwiJz48L3NyYz5cIik7XG4gIHZhciBvdGhlcl9yb3dzID0gXCI8dGQ+XCIgKyBvYmouVGl0bGUgKyBcIjwvdGQ+PHRkPlwiICsgb2JqLlllYXIgKyBcIjwvdGQ+PHRkPlwiO1xuICBvdGhlcl9yb3dzICs9IG1ha2VSYXRpbmdJbWdUZXh0KG9iaik7XG4gIG90aGVyX3Jvd3MgKz0gXCI8L3RkPlwiXG4gIG90aGVyX3Jvd3MgKz0gXCI8dGQ+PGJ1dHRvbiBjbGFzcz0ndHJhaWxlci1idG4nIHF1ZXJ5PSdcIiArIG9iai5UaXRsZS5yZXBsYWNlKC9bXFwuLC1cXC8jISQlXFxeJlxcKjs6e309XFwtX2B+KCldL2csXCJcIikuc3BsaXQoXCIgXCIpLmpvaW4oXCItXCIpICsgXCInPlZpZXc8L2J1dHRvbj5cIlxuICBvdGhlcl9yb3dzICs9IFwiPHRkPjxwIFwiICsgbWFrZU1ldGFSYXRpbmdUZXh0KG9iaikgKyBcIjwvcD48L3RkPlwiO1xuICBvdGhlcl9yb3dzICs9IFwiPHRkPjxwIGNsYXNzPSdpbWRiLXJhdGluZyc+XCIgKyBvYmouaW1kYlJhdGluZyArIFwiPC9wPjwvdGQ+XCI7XG4gIG90aGVyX3Jvd3MgKz0gXCI8dGQ+PGJ1dHRvbiBjbGFzcz0nd2F0Y2hlZC1idG4nPldhdGNoZWQ8L2J1dHRvbj48L3RkPlwiO1xuICB2YXIgJG90aGVyX3Jvd3MgPSAkKG90aGVyX3Jvd3MpO1xuICAkb3RoZXJfcm93cy5maW5kKFwiYnV0dG9uLndhdGNoZWQtYnRuXCIpLmFkZENsYXNzKFwiYnRuIGJ0bi1tZCBidG4tZGFuZ2VyXCIpO1xuICAkb3RoZXJfcm93cy5maW5kKFwiYnV0dG9uLnRyYWlsZXItYnRuXCIpLmFkZENsYXNzKFwiYnRuIGJ0bi1tZCBidG4tZGVmYXVsdFwiKTtcbiAgJHJvdy5hcHBlbmQoJHBvc3Rlcl90ZCkuYXBwZW5kKCRvdGhlcl9yb3dzKTtcbiAgcmV0dXJuICRyb3c7XG59XG5cbmZ1bmN0aW9uIG1ha2VNZXRhUmF0aW5nVGV4dChvYmopIHtcbiAgdmFyIHJldHVybl9zdHIgPSBcImNsYXNzPSdtZXRhc2NvcmUgXCI7XG4gIGlmIChwYXJzZUludChvYmouTWV0YXNjb3JlKSA+IDYwKSB7XG4gICAgcmV0dXJuX3N0ciArPSBcIm1ldGEtcG9zaXRpdmVcIjtcbiAgfSBlbHNlIGlmIChwYXJzZUludChvYmouTWV0YXNjb3JlKSA+IDM5KSB7XG4gICAgcmV0dXJuX3N0ciArPSBcIm1ldGEtbmV1dHJhbFwiO1xuICB9IGVsc2UgaWYgKHBhcnNlSW50KG9iai5NZXRhc2NvcmUpID49IDApIHtcbiAgICByZXR1cm5fc3RyICs9IFwibWV0YS1uZWdhdGl2ZVwiO1xuICB9XG4gIHJldHVybl9zdHIgKz0gXCInPlwiKyBvYmouTWV0YXNjb3JlXG4gIHJldHVybiByZXR1cm5fc3RyO1xufVxuXG5mdW5jdGlvbiBtYWtlUmF0aW5nSW1nVGV4dChvYmopIHtcbiAgaWYgKG9iai5SYXRlZCA9PT0gXCJHXCIpIHtcbiAgICByZXR1cm4gXCI8aW1nIGNsYXNzPSdyYXRpbmctaW1nJyBzcmM9Jy4uL2ltYWdlcy9HLnN2Zyc+XCI7XG4gIH0gZWxzZSBpZiAob2JqLlJhdGVkID09PSBcIlBHXCIpIHtcbiAgICByZXR1cm4gXCI8aW1nIGNsYXNzPSdyYXRpbmctaW1nJyBzcmM9Jy4uL2ltYWdlcy9QRy5zdmcnPlwiO1xuICB9IGVsc2UgaWYgKG9iai5SYXRlZCA9PT0gXCJQRy0xM1wiKSB7XG4gICAgcmV0dXJuIFwiPGltZyBjbGFzcz0ncmF0aW5nLWltZycgc3JjPScuLi9pbWFnZXMvUEctMTMuc3ZnJz5cIjtcbiAgfSBlbHNlIGlmIChvYmouUmF0ZWQgPT09IFwiUlwiKSB7XG4gICAgcmV0dXJuIFwiPGltZyBjbGFzcz0ncmF0aW5nLWltZycgc3JjPScuLi9pbWFnZXMvUi5zdmcnPlwiO1xuICB9IGVsc2UgaWYgKG9iai5SYXRlZCA9PT0gXCJOQy0xN1wiKSB7XG4gICAgcmV0dXJuIFwiPGltZyBjbGFzcz0ncmF0aW5nLWltZycgc3JjPScuLi9pbWFnZXMvTkMtMTcuc3ZnJz5cIjtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gXCI8c3Bhbj5OL0E8L3NwYW4+XCJcbiAgfVxufVxuXG5mdW5jdGlvbiB3cml0ZVRvRmlyZWJhc2Uob2JqKSB7XG4gIHZhciBuZXdQdXNoID0gbW92aWVsaXN0LnB1c2gob2JqKTtcbiAgb2JqLmRhdGFfaWQgPSBuZXdQdXNoLmtleSgpO1xuXG4gIC8vJC5wb3N0KGAke0ZJUkVCQVNFX1VSTH0vdXNlcnMvJHtmYi5nZXRBdXRoKCkudWlkfS9tb3ZpZWxpc3QuanNvbj9hdXRoPSR7ZmIuZ2V0QXV0aCgpLnRva2VufWAsIEpTT04uc3RyaW5naWZ5KG9iaiksIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gIC8vICBvYmouZGF0YV9pZCA9IHJlc3BvbnNlLm5hbWU7XG4gIC8vfSlcbn1cblxuZnVuY3Rpb24gZGVsZXRlRnJvbUZpcmViYXNlKGlkKSB7XG4gIG1vdmllbGlzdC5jaGlsZChpZCkuc2V0KG51bGwpO1xuXG4gIC8vIHZhciBkZWxldGVVcmwgPSBgJHtGSVJFQkFTRV9VUkx9L3VzZXJzLyR7ZmIuZ2V0QXV0aCgpLnVpZH0vbW92aWVsaXN0LyR7aWR9Lmpzb24/YXV0aD0ke2ZiLmdldEF1dGgoKS50b2tlbn1gO1xuICAvLyAkLmFqYXgoe3VybDogZGVsZXRlVXJsLCB0eXBlOiAnREVMRVRFJ30pO1xufVxuXG4vL2Z1bmN0aW9uIHRhYmxlTG9hZCgpIHtcbi8vICAkLmdldChgJHtGSVJFQkFTRV9VUkx9L3VzZXJzLyR7ZmIuZ2V0QXV0aCgpLnVpZH0vbW92aWVsaXN0Lmpzb24/YXV0aD0ke2ZiLmdldEF1dGgoKS50b2tlbn1gLCBmdW5jdGlvbihkYl9kYXRhKSB7XG4vLyAgICBkYl9kYXRhICYmIF8oZGJfZGF0YSkuZm9yRWFjaChmdW5jdGlvbih2YWx1ZSwga2V5KSB7XG4vLyAgICAgIGFkZFRvVGFibGUodmFsdWUsIGtleSk7XG4vLyAgICB9KS52YWx1ZSgpO1xuLy8gIH0pXG4vL31cbiJdfQ==